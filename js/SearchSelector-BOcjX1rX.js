var S=(w,T,t)=>new Promise((s,d)=>{var u=r=>{try{p(t.next(r))}catch(n){d(n)}},o=r=>{try{p(t.throw(r))}catch(n){d(n)}},p=r=>r.done?s(r.value):Promise.resolve(r.value).then(u,o);p((t=t.apply(w,T)).next())});import{w as V,_ as H}from"./bootstrap-DKNppDM-.js";/* empty css                  */import{E as G}from"./el-popover-Bz24p6UJ.js";import"./css-B_CDxaI0.js";import"./css-B9p04GUO.js";import{ElInput as J}from"./index-DlI7P0K8.js";import{ElButton as Q}from"./index-CB6HUdZy.js";import{e as X,r as c,c as g,w as B,o as Y,h as b,j as y,y as C,u as L,I as z,l as i,t as _,F as Z,z as ee,n as te,p as ae,x as le,s as K}from"../jse/index-index-CClcjv6z.js";import"./index-BTdHKsqd.js";import"./index-CL-GF0I0.js";import"./_arrayPush-BBRYry4V.js";import"./index-DbQGFv3H.js";import"./use-form-item-94WQABG4.js";import"./use-form-common-props-CFNhUBoH.js";import"./browser-auKJFWin.js";import"./event-BB_Ol6Sd.js";import"./index-C7broldF.js";import"./index-BpRugPLb.js";import"./error-Cq9Fpw4b.js";import"./index-BLKRwB_-.js";const oe={class:"search-selector"},se={class:"search-selector-content"},re={class:"search-input-wrapper"},ne={key:0,class:"loading-state"},ie={class:"loading-text"},ue=["onClick","onMouseenter"],ce={class:"option-content"},de={class:"option-label"},ve={key:2,class:"no-data-state"},pe={class:"no-data-text"},fe=X({__name:"SearchSelector",props:{modelValue:{},options:{default:()=>[]},dataSource:{},placeholder:{default:"请选择"},searchPlaceholder:{default:"请输入搜索关键词"},buttonText:{},buttonType:{default:"default"},buttonSize:{default:"default"},placement:{default:"bottom-start"},trigger:{default:"click"},popoverWidth:{default:300},disabled:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},remote:{type:Boolean,default:!1},noDataText:{default:"暂无数据"},loadingText:{default:"加载中..."},debounceDelay:{default:300},minSearchLength:{default:0}},emits:["update:modelValue","change","search","focus","blur","visible-change","load-error"],setup(w,{emit:T}){const t=w,s=T,d=c(!1),u=c(""),o=c(-1),p=c(),r=c(!1),n=c([]),m=c(new Map),k=c(null),v=g(()=>t.remote||t.dataSource?n.value:t.options),M=g(()=>v.value.find(e=>e.value===t.modelValue)),E=g(()=>{var e;return((e=M.value)==null?void 0:e.label)||""}),O=g(()=>t.buttonText?t.buttonText:E.value?E.value:v.value.length>0?v.value[0].label:t.placeholder),f=g(()=>t.remote||t.dataSource?n.value.filter(e=>!e.disabled):!t.filterable||!u.value?v.value.filter(e=>!e.disabled):v.value.filter(e=>e.disabled?!1:e.label.toLowerCase().includes(u.value.toLowerCase()))),A=e=>{d.value=e,e&&(u.value="",o.value=-1,K(()=>{const a=document.querySelector(".search-selector-content .el-input__inner");a==null||a.focus()})),s("visible-change",e)},F=()=>{s("focus")},N=()=>{s("blur")},P=e=>{o.value=-1,s("search",e),(t.remote||t.dataSource)&&U(e)},U=e=>S(null,null,function*(){if(k.value&&clearTimeout(k.value),e.length<t.minSearchLength){n.value=[];return}const a=e.toLowerCase();if(m.value.has(a)){n.value=m.value.get(a)||[];return}k.value=setTimeout(()=>S(null,null,function*(){if(t.dataSource){r.value=!0;try{const l=yield t.dataSource(e),h=Array.isArray(l)?l:[];m.value.set(a,h),n.value=h}catch(l){console.error("搜索失败:",l),s("load-error",l),n.value=[]}finally{r.value=!1}}}),t.debounceDelay)}),x=e=>{e.disabled||(s("update:modelValue",e.value),s("change",e.value,e),d.value=!1)},$=()=>{if(o.value>=0&&o.value<f.value.length){const e=f.value[o.value];x(e)}},j=()=>{o.value>0&&(o.value--,D())},q=()=>{o.value<f.value.length-1&&(o.value++,D())},R=()=>{d.value=!1},D=()=>{K(()=>{var a;const e=(a=p.value)==null?void 0:a.querySelector(".option-item-highlighted");e&&e.scrollIntoView({block:"nearest"})})};B(()=>f.value,()=>{o.value=-1});const I=()=>S(null,null,function*(){if(t.dataSource&&!t.remote)try{r.value=!0;const e=yield t.dataSource(""),a=Array.isArray(e)?e:[];if(n.value=a,m.value.set("",a),t.modelValue===void 0&&a.length>0){const l=a[0];l.disabled||s("update:modelValue",l.value)}}catch(e){console.error("初始化数据失败:",e),s("load-error",e)}finally{r.value=!1}else if(!t.dataSource&&t.modelValue===void 0&&v.value.length>0){const e=v.value[0];e.disabled||s("update:modelValue",e.value)}});return Y(()=>{I()}),B(()=>t.options,e=>{if(!t.dataSource&&e.length>0&&!e.find(l=>l.value===t.modelValue)&&t.modelValue===void 0){const l=e[0];l.disabled||s("update:modelValue",l.value)}},{immediate:!0}),B(()=>t.dataSource,()=>{m.value.clear(),n.value=[],u.value="",I()}),(e,a)=>(y(),b("div",oe,[C(L(G),{placement:e.placement,trigger:e.trigger,width:e.popoverWidth,visible:d.value,"onUpdate:visible":A},{reference:z(()=>[C(L(Q),{type:e.buttonType,size:e.buttonSize,disabled:e.disabled,class:"search-selector-button",onFocus:F,onBlur:N},{default:z(()=>[le(_(O.value),1)]),_:1},8,["type","size","disabled"])]),default:z(()=>[i("div",se,[i("div",re,[C(L(J),{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=l=>u.value=l),placeholder:e.searchPlaceholder,size:"default",clearable:"","prefix-icon":"Search",class:"search-input",onInput:P,onKeydown:[V($,["enter"]),V(j,["up"]),V(q,["down"]),V(R,["esc"])]},null,8,["modelValue","placeholder"])]),i("div",{class:"options-list",ref_key:"optionsListRef",ref:p},[r.value?(y(),b("div",ne,[a[1]||(a[1]=i("div",{class:"loading-spinner"},null,-1)),i("span",ie,_(e.loadingText),1)])):f.value.length>0?(y(!0),b(Z,{key:1},ee(f.value,(l,h)=>(y(),b("div",{key:l.value,class:te(["option-item",{"option-item-selected":l.value===e.modelValue,"option-item-highlighted":h===o.value}]),onClick:W=>x(l),onMouseenter:W=>o.value=h},[ae(e.$slots,"option",{option:l,index:h},()=>[i("div",ce,[i("span",de,_(l.label),1)])],!0)],42,ue))),128)):(y(),b("div",ve,[a[2]||(a[2]=i("div",{class:"no-data-icon"},[i("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"})])],-1)),i("span",pe,_(e.noDataText),1)]))],512)])]),_:3},8,["placement","trigger","width","visible"])]))}}),Oe=H(fe,[["__scopeId","data-v-70f19ad5"]]);export{Oe as default};
