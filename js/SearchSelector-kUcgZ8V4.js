var S=(w,T,t)=>new Promise((o,d)=>{var u=r=>{try{p(t.next(r))}catch(n){d(n)}},s=r=>{try{p(t.throw(r))}catch(n){d(n)}},p=r=>r.done?o(r.value):Promise.resolve(r.value).then(u,s);p((t=t.apply(w,T)).next())});import{w as V,_ as H}from"./bootstrap-CRMPbCAg.js";import"./css-Y7-lT1k2.js";import"./css--NxZTE4c.js";/* empty css                  */import{E as G}from"./el-popover-CifyfLE9.js";import{ElInput as J}from"./index-BX4pXHqX.js";import{ElButton as Q}from"./index-BBB7ueyP.js";import{e as X,r as c,c as g,w as B,o as Y,h as b,y as C,I as L,u as z,j as y,l as i,t as _,F as Z,z as ee,x as te,n as ae,p as le,s as I}from"../jse/index-index-BLEn1CMS.js";import"./index-DroBubct.js";import"./index-BuaG4Xso.js";import"./_arrayPush-Dldpwei2.js";import"./index-DVO058gF.js";import"./use-form-item-C8EWOxB0.js";import"./use-form-common-props-H4BW1-Nh.js";import"./browser-CMFvwe14.js";import"./event-BB_Ol6Sd.js";import"./index-CQxSKuWz.js";import"./index-BplgeGre.js";import"./error-Cq9Fpw4b.js";import"./index-DVi7n050.js";const oe={class:"search-selector"},se={class:"search-selector-content"},re={class:"search-input-wrapper"},ne={key:0,class:"loading-state"},ie={class:"loading-text"},ue=["onClick","onMouseenter"],ce={class:"option-content"},de={class:"option-label"},ve={key:2,class:"no-data-state"},pe={class:"no-data-text"},fe=X({__name:"SearchSelector",props:{modelValue:{},options:{default:()=>[]},dataSource:{},placeholder:{default:"请选择"},searchPlaceholder:{default:"请输入搜索关键词"},buttonText:{},buttonType:{default:"default"},buttonSize:{default:"default"},placement:{default:"bottom-start"},trigger:{default:"click"},popoverWidth:{default:300},disabled:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},remote:{type:Boolean,default:!1},noDataText:{default:"暂无数据"},loadingText:{default:"加载中..."},debounceDelay:{default:300},minSearchLength:{default:0}},emits:["update:modelValue","change","search","focus","blur","visible-change","load-error"],setup(w,{emit:T}){const t=w,o=T,d=c(!1),u=c(""),s=c(-1),p=c(),r=c(!1),n=c([]),m=c(new Map),k=c(null),v=g(()=>t.remote||t.dataSource?n.value:t.options),K=g(()=>v.value.find(e=>e.value===t.modelValue)),A=g(()=>{var e;return((e=K.value)==null?void 0:e.label)||""}),M=g(()=>t.buttonText?t.buttonText:A.value?A.value:v.value.length>0?v.value[0].label:t.placeholder),f=g(()=>t.remote||t.dataSource?n.value.filter(e=>!e.disabled):!t.filterable||!u.value?v.value.filter(e=>!e.disabled):v.value.filter(e=>e.disabled?!1:e.label.toLowerCase().includes(u.value.toLowerCase()))),O=e=>{d.value=e,e&&(u.value="",s.value=-1,I(()=>{const l=document.querySelector(".search-selector-content .el-input__inner");l==null||l.focus()})),o("visible-change",e)},F=()=>{o("focus")},N=()=>{o("blur")},P=e=>{s.value=-1,o("search",e),(t.remote||t.dataSource)&&U(e)},U=e=>S(null,null,function*(){if(k.value&&clearTimeout(k.value),e.length<t.minSearchLength){n.value=[];return}const l=e.toLowerCase();if(m.value.has(l)){n.value=m.value.get(l)||[];return}k.value=setTimeout(()=>S(null,null,function*(){if(t.dataSource){r.value=!0;try{const a=yield t.dataSource(e),h=Array.isArray(a)?a:[];m.value.set(l,h),n.value=h}catch(a){console.error("搜索失败:",a),o("load-error",a),n.value=[]}finally{r.value=!1}}}),t.debounceDelay)}),E=e=>{e.disabled||(o("update:modelValue",e.value),o("change",e.value,e),d.value=!1)},$=()=>{if(s.value>=0&&s.value<f.value.length){const e=f.value[s.value];E(e)}},j=()=>{s.value>0&&(s.value--,x())},q=()=>{s.value<f.value.length-1&&(s.value++,x())},R=()=>{d.value=!1},x=()=>{I(()=>{var l;const e=(l=p.value)==null?void 0:l.querySelector(".option-item-highlighted");e&&e.scrollIntoView({block:"nearest"})})};B(()=>f.value,()=>{s.value=-1});const D=()=>S(null,null,function*(){if(t.dataSource&&!t.remote)try{r.value=!0;const e=yield t.dataSource(""),l=Array.isArray(e)?e:[];if(n.value=l,m.value.set("",l),t.modelValue===void 0&&l.length>0){const a=l[0];a.disabled||(console.log("Auto-selecting first enterprise:",a),o("update:modelValue",a.value),o("change",a.value,a))}}catch(e){console.error("初始化数据失败:",e),o("load-error",e)}finally{r.value=!1}else if(!t.dataSource&&t.modelValue===void 0&&v.value.length>0){const e=v.value[0];e.disabled||(console.log("Auto-selecting first enterprise (static):",e),o("update:modelValue",e.value),o("change",e.value,e))}});return Y(()=>{D()}),B(()=>t.options,e=>{if(!t.dataSource&&e.length>0&&!e.find(a=>a.value===t.modelValue)&&t.modelValue===void 0){const a=e[0];a.disabled||(console.log("Auto-selecting first enterprise (options changed):",a),o("update:modelValue",a.value),o("change",a.value,a))}},{immediate:!0}),B(()=>t.dataSource,()=>{m.value.clear(),n.value=[],u.value="",D()}),(e,l)=>(y(),b("div",oe,[C(z(G),{placement:e.placement,trigger:e.trigger,width:e.popoverWidth,visible:d.value,"onUpdate:visible":O},{reference:L(()=>[C(z(Q),{type:e.buttonType,size:e.buttonSize,disabled:e.disabled,class:"search-selector-button",onFocus:F,onBlur:N},{default:L(()=>[te(_(M.value),1)]),_:1},8,["type","size","disabled"])]),default:L(()=>[i("div",se,[i("div",re,[C(z(J),{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value=a),placeholder:e.searchPlaceholder,size:"default",clearable:"","prefix-icon":"Search",class:"search-input",onInput:P,onKeydown:[V($,["enter"]),V(j,["up"]),V(q,["down"]),V(R,["esc"])]},null,8,["modelValue","placeholder"])]),i("div",{class:"options-list",ref_key:"optionsListRef",ref:p},[r.value?(y(),b("div",ne,[l[1]||(l[1]=i("div",{class:"loading-spinner"},null,-1)),i("span",ie,_(e.loadingText),1)])):f.value.length>0?(y(!0),b(Z,{key:1},ee(f.value,(a,h)=>(y(),b("div",{key:a.value,class:ae(["option-item",[{"option-item-selected":a.value===e.modelValue,"option-item-highlighted":h===s.value}]]),onClick:W=>E(a),onMouseenter:W=>s.value=h},[le(e.$slots,"option",{option:a,index:h},()=>[i("div",ce,[i("span",de,_(a.label),1)])],!0)],42,ue))),128)):(y(),b("div",ve,[l[2]||(l[2]=i("div",{class:"no-data-icon"},[i("svg",{class:"h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"})])],-1)),i("span",pe,_(e.noDataText),1)]))],512)])]),_:3},8,["placement","trigger","width","visible"])]))}}),Me=H(fe,[["__scopeId","data-v-e8c86166"]]);export{Me as default};
