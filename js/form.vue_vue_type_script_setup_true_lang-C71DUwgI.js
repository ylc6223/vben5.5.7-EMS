var d=(t,s,m)=>new Promise((n,u)=>{var y=a=>{try{p(m.next(a))}catch(l){u(l)}},i=a=>{try{p(m.throw(a))}catch(l){u(l)}},p=a=>a.done?n(a.value):Promise.resolve(a.value).then(y,i);p((m=m.apply(t,s)).next())});import{r as f,$ as e,s as v,p as b}from"./bootstrap-CRMPbCAg.js";import"./css-Y7-lT1k2.js";import{ElButton as w}from"./index-BBB7ueyP.js";import{e as _,r as C,c as N,v as T,j as k,I as h,y as x,u as c,l as D,x as V,t as F}from"../jse/index-index-BLEn1CMS.js";import{u as R}from"./use-modal-DkICd823.js";function A(){return d(this,null,function*(){return f.get("/system/dept/list")})}function L(t){return d(this,null,function*(){return f.post("/system/dept",t)})}function B(t,s){return d(this,null,function*(){return f.put(`/system/dept/${t}`,s)})}function E(t){return d(this,null,function*(){return f.delete(`/system/dept/${t}`)})}function S(){return[{component:"Input",fieldName:"name",label:e("system.dept.deptName"),rules:v().min(2,e("ui.formRules.minLength",[e("system.dept.deptName"),2])).max(20,e("ui.formRules.maxLength",[e("system.dept.deptName"),20]))},{component:"ApiTreeSelect",componentProps:{allowClear:!0,api:A,class:"w-full",labelField:"name",valueField:"id",childrenField:"children"},fieldName:"pid",label:e("system.dept.parentDept")},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:[{label:e("common.enabled"),value:1},{label:e("common.disabled"),value:0}],optionType:"button"},defaultValue:1,fieldName:"status",label:e("system.dept.status")},{component:"Textarea",componentProps:{maxLength:50,rows:3,showCount:!0},fieldName:"remark",label:e("system.dept.remark"),rules:v().max(50,e("ui.formRules.maxLength",[e("system.dept.remark"),50])).optional()}]}function G(t){return[{align:"left",field:"name",fixed:"left",title:e("system.dept.deptName"),treeNode:!0,width:150},{cellRender:{name:"CellTag"},field:"status",title:e("system.dept.status"),width:100},{field:"createTime",title:e("system.dept.createTime"),width:180},{field:"remark",title:e("system.dept.remark")},{align:"right",cellRender:{attrs:{nameField:"name",nameTitle:e("system.dept.name"),onClick:t},name:"CellOperation",options:[{code:"append",text:"新增下级"},"edit",{code:"delete",disabled:s=>!!(s.children&&s.children.length>0)}]},field:"operation",fixed:"right",headerAlign:"center",showOverflow:!1,title:e("system.dept.operation"),width:200}]}const $={class:"flex-auto"},z=_({__name:"form",emits:["success"],setup(t,{emit:s}){const m=s,n=C(),u=N(()=>{var r;return(r=n.value)!=null&&r.id?e("ui.actionTitle.edit",[e("system.dept.name")]):e("ui.actionTitle.create",[e("system.dept.name")])}),[y,i]=b({layout:"vertical",schema:S(),showDefaultActions:!1});function p(){i.resetForm(),i.setValues(n.value||{})}const[a,l]=R({onConfirm(){return d(this,null,function*(){var o;const{valid:r}=yield i.validate();if(r){l.lock();const g=yield i.getValues();try{yield(o=n.value)!=null&&o.id?B(n.value.id,g):L(g),l.close(),m("success")}finally{l.lock(!1)}}})},onOpenChange(r){if(r){const o=l.getData();o&&(o.pid===0&&(o.pid=void 0),n.value=o,i.setValues(n.value))}}});return(r,o)=>(k(),T(c(a),{title:u.value},{"prepend-footer":h(()=>[D("div",$,[x(c(w),{type:"danger",onClick:p},{default:h(()=>[V(F(c(e)("common.reset")),1)]),_:1})])]),default:h(()=>[x(c(y),{class:"mx-4"})]),_:1},8,["title"]))}});export{z as _,E as d,A as g,G as u};
