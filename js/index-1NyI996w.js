var D=Object.defineProperty,O=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var x=(a,n,o)=>n in a?D(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o,Y=(a,n)=>{for(var o in n||(n={}))S.call(n,o)&&x(a,o,n[o]);if(w)for(var o of w(n))W.call(n,o)&&x(a,o,n[o]);return a},E=(a,n)=>O(a,P(n));var y=(a,n,o)=>new Promise((f,h)=>{var u=s=>{try{p(o.next(s))}catch(g){h(g)}},I=s=>{try{p(o.throw(s))}catch(g){h(g)}},p=s=>s.done?f(s.value):Promise.resolve(s.value).then(u,I);p((o=o.apply(a,n)).next())});import{$ as t,_ as k}from"./bootstrap-CRMPbCAg.js";import{e as F,r as A,w as G,v as z,j as $,I as R,y as d,u as c,a0 as b}from"../jse/index-index-BLEn1CMS.js";import{E as j,a as _,s as q}from"./enterprise-DJBlpcZc.js";import{u as T}from"./vxe-table-3fC9prEm.js";import{g as N}from"./report-CnS7i5P4.js";import{_ as L}from"./page.vue_vue_type_script_setup_true_lang-Jfv2R4fZ.js";import"./error-Cq9Fpw4b.js";import"./strings-BXOxzJ4d.js";import"./event-BB_Ol6Sd.js";import"./vnode-En5plHQE.js";import"./loading-BJEPGsK4.js";import"./css-Y7-lT1k2.js";import"./index-DVO058gF.js";import"./debounce-DNXs5Rvf.js";import"./index-CQxSKuWz.js";import"./scroll-xfvYtqVg.js";import"./index-BBB7ueyP.js";import"./index-DVi7n050.js";import"./use-form-item-C8EWOxB0.js";import"./use-form-common-props-H4BW1-Nh.js";function B(a="monthly",n){return[{align:"center",field:"time",fixed:"left",title:a==="monthly"?t("system.chargingIncomeReport.date"):t("system.chargingIncomeReport.month"),width:120},{align:"center",title:t("system.chargingIncomeReport.sharp"),children:[{align:"center",field:"sharpElectricity",title:t("system.chargingIncomeReport.sharpElectricity"),minWidth:120},{align:"center",field:"sharpCost",title:t("system.chargingIncomeReport.sharpCost"),minWidth:120}]},{align:"center",title:t("system.chargingIncomeReport.peak"),children:[{align:"center",field:"peakElectricity",title:t("system.chargingIncomeReport.peakElectricity"),minWidth:120},{align:"center",field:"peakCost",title:t("system.chargingIncomeReport.peakCost"),minWidth:120}]},{align:"center",title:t("system.chargingIncomeReport.flat"),children:[{align:"center",field:"flatElectricity",title:t("system.chargingIncomeReport.flatElectricity"),minWidth:120},{align:"center",field:"flatCost",title:t("system.chargingIncomeReport.flatCost"),minWidth:120}]},{align:"center",title:t("system.chargingIncomeReport.valley"),children:[{align:"center",field:"valleyElectricity",title:t("system.chargingIncomeReport.valleyElectricity"),minWidth:120},{align:"center",field:"valleyCost",title:t("system.chargingIncomeReport.valleyCost"),minWidth:120}]},{align:"center",title:t("system.chargingIncomeReport.deepValley"),children:[{align:"center",field:"deepValleyElectricity",title:t("system.chargingIncomeReport.deepValleyElectricity"),minWidth:120},{align:"center",field:"deepValleyCost",title:t("system.chargingIncomeReport.deepValleyCost"),minWidth:120}]},{align:"center",field:"chargingAmount",title:t("system.chargingIncomeReport.chargingAmount"),minWidth:140},{align:"center",field:"netProfit",title:t("system.chargingIncomeReport.netProfit"),minWidth:140}]}const U=F({__name:"index",setup(a){const n=A("monthly");function o(l){return y(this,null,function*(){try{return{items:(yield N(l)).items}}catch(e){return console.error("获取充电收益报表数据失败:",e),{items:[]}}})}function f(l){const e={time:t("system.chargingIncomeReport.footer.total")};if(l.length===0)return e;const r=l[0];return Object.keys(r).forEach(i=>{if(i!=="time"){const m=l.reduce((C,M)=>{const v=Number(M[i])||0;return C+v},0);e[i]=Number(m.toFixed(2))}}),e}function h(l){const e=l==="monthly";return{collapsed:!1,commonConfig:{componentProps:{class:"w-full"}},fieldMappingTime:[["time",["startTime","endTime"],e?"YYYY-MM-DD":"YYYY-MM"]],schema:[{component:"SearchSelector",fieldName:"enterprise",label:t("system.chargingIncomeReport.form.enterpriseSelect"),componentProps:{class:"w-full sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-sm",placeholder:t("system.chargingIncomeReport.form.enterprisePlaceholder"),searchPlaceholder:t("system.chargingIncomeReport.form.enterpriseSearchPlaceholder"),buttonType:"default",buttonSize:"default",placement:"bottom-start",popoverWidth:300,filterable:!0,remote:!1,dataSource:r=>y(null,null,function*(){try{console.log("SearchSelector dataSource called with keyword:",r);const i=yield q(r||void 0);return console.log("Enterprise list loaded:",i.length,"items"),i}catch(i){console.error("获取企业列表失败:",i);const m=[];return r&&r.trim()?m.filter(C=>C.label.toLowerCase().includes(r.toLowerCase())):(console.log("Using fallback enterprise data:",m.length,"items"),m)}}),onChange:(r,i)=>{console.log("Enterprise selected:",r,i)}}},{component:"RangePicker",defaultValue:e?[b().subtract(7,"days"),b()]:[b().subtract(11,"months").startOf("month"),b().endOf("month")],fieldName:"time",label:e?t("system.chargingIncomeReport.form.dateRange"):t("system.chargingIncomeReport.form.monthRange"),componentProps:{class:"w-full",startPlaceholder:e?t("system.chargingIncomeReport.form.startDate"):t("system.chargingIncomeReport.form.startMonth"),endPlaceholder:e?t("system.chargingIncomeReport.form.endDate"):t("system.chargingIncomeReport.form.endMonth"),rangeSeparator:t("system.chargingIncomeReport.form.separator"),format:e?"YYYY-MM-DD":"YYYY-MM",valueFormat:e?"YYYY-MM-DD":"YYYY-MM",clearable:!0,size:"default",type:e?"daterange":"monthrange"}}],showCollapseButton:!1,submitOnChange:!0,submitOnEnter:!1,layout:"horizontal"}}const u=l=>({columns:B(l),height:"auto",keepSource:!0,showFooter:!0,resizable:!0,autoResize:!0,columnConfig:{resizable:!0,useKey:!0},border:!0,stripe:!0,round:!0,footerData:[{time:t("system.chargingIncomeReport.footer.total"),sharpElectricity:0,sharpCost:0,peakElectricity:0,peakCost:0,flatElectricity:0,flatCost:0,valleyElectricity:0,valleyCost:0,deepValleyElectricity:0,deepValleyCost:0,chargingAmount:0,netProfit:0}],pagerConfig:{enabled:!1},rowConfig:{keyField:"time"},toolbarConfig:{search:!1,custom:!0,export:!0,refresh:{code:"query"},zoom:!0}}),[I,p]=T({formOptions:h("monthly"),showSearchForm:!0,gridOptions:E(Y({},u("monthly")),{proxyConfig:{autoLoad:!1,ajax:{query:(l,e)=>y(null,null,function*(){var i;if(console.log("月报搜索参数:",e),!(e!=null&&e.enterprise))return console.log("未选择企业，跳过月报数据查询"),{items:[]};console.log("开始查询月报数据，企业:",e.enterprise);const r=yield o({startTime:e==null?void 0:e.startTime,endTime:e==null?void 0:e.endTime,enterprise:e==null?void 0:e.enterprise,reportType:"monthly"});if(console.log("月报数据查询完成，数据条数:",((i=r.items)==null?void 0:i.length)||0),r.items&&r.items.length>0){const m=f(r.items);p.setGridOptions({footerData:[m]})}return r})}}})}),[s,g]=T({formOptions:h("yearly"),showSearchForm:!0,gridOptions:E(Y({},u("yearly")),{proxyConfig:{autoLoad:!1,ajax:{query:(l,e)=>y(null,null,function*(){var i;if(console.log("年报搜索参数:",e),!(e!=null&&e.enterprise))return console.log("未选择企业，跳过年报数据查询"),{items:[]};console.log("开始查询年报数据，企业:",e.enterprise);const r=yield o({startTime:e==null?void 0:e.startTime,endTime:e==null?void 0:e.endTime,enterprise:e==null?void 0:e.enterprise,reportType:"yearly"});if(console.log("年报数据查询完成，数据条数:",((i=r.items)==null?void 0:i.length)||0),r.items&&r.items.length>0){const m=f(r.items);g.setGridOptions({footerData:[m]})}return r})}}})});return G(n,l=>{setTimeout(()=>{l==="monthly"?p.query():g.query()},100)}),(l,e)=>($(),z(c(L),{"auto-content-height":""},{default:R(()=>[d(c(j),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value=r),"tab-position":"left",class:"charging-income-report-tabs"},{default:R(()=>[d(c(_),{label:c(t)("system.chargingIncomeReport.tabs.monthly"),name:"monthly"},{default:R(()=>[d(c(I),{"table-title":`${c(t)("system.chargingIncomeReport.title")} - ${c(t)("system.chargingIncomeReport.tabs.monthly")}`,"table-title-help":c(t)("system.chargingIncomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"]),d(c(_),{label:c(t)("system.chargingIncomeReport.tabs.yearly"),name:"yearly"},{default:R(()=>[d(c(s),{"table-title":`${c(t)("system.chargingIncomeReport.title")} - ${c(t)("system.chargingIncomeReport.tabs.yearly")}`,"table-title-help":c(t)("system.chargingIncomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}))}}),ye=k(U,[["__scopeId","data-v-8ced6680"]]);export{ye as default};
