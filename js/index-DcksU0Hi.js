var D=Object.defineProperty,O=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var x=(r,n,i)=>n in r?D(r,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[n]=i,Y=(r,n)=>{for(var i in n||(n={}))P.call(n,i)&&x(r,i,n[i]);if(w)for(var i of w(n))F.call(n,i)&&x(r,i,n[i]);return r},T=(r,n)=>O(r,S(n));var u=(r,n,i)=>new Promise((g,d)=>{var f=s=>{try{p(i.next(s))}catch(h){d(h)}},b=s=>{try{p(i.throw(s))}catch(h){d(h)}},p=s=>s.done?g(s.value):Promise.resolve(s.value).then(f,b);p((i=i.apply(r,n)).next())});import{$ as e,_ as k}from"./bootstrap-CRMPbCAg.js";import{e as E,r as G,w as z,v as N,j as $,I as v,y as I,u as c,a0 as R}from"../jse/index-index-BLEn1CMS.js";import{E as j,a as _,s as q}from"./enterprise-DJBlpcZc.js";import{u as M}from"./vxe-table-3fC9prEm.js";import{c as L}from"./report-CnS7i5P4.js";import{_ as B}from"./page.vue_vue_type_script_setup_true_lang-Jfv2R4fZ.js";import"./error-Cq9Fpw4b.js";import"./strings-BXOxzJ4d.js";import"./event-BB_Ol6Sd.js";import"./vnode-En5plHQE.js";import"./loading-BJEPGsK4.js";import"./css-Y7-lT1k2.js";import"./index-DVO058gF.js";import"./debounce-DNXs5Rvf.js";import"./index-CQxSKuWz.js";import"./scroll-xfvYtqVg.js";import"./index-BBB7ueyP.js";import"./index-DVi7n050.js";import"./use-form-item-C8EWOxB0.js";import"./use-form-common-props-H4BW1-Nh.js";function U(r="monthly",n){return[{align:"center",field:"time",fixed:"left",title:r==="monthly"?e("system.photovoltaicIncomeReport.date"):e("system.photovoltaicIncomeReport.month"),width:120},{align:"center",title:e("system.photovoltaicIncomeReport.consumption"),children:[{align:"center",field:"sharpAmount",title:e("system.photovoltaicIncomeReport.sharpAmount"),minWidth:120},{align:"center",field:"sharpIncome",title:e("system.photovoltaicIncomeReport.sharpIncome"),minWidth:120},{align:"center",field:"peakAmount",title:e("system.photovoltaicIncomeReport.peakAmount"),minWidth:120},{align:"center",field:"peakIncome",title:e("system.photovoltaicIncomeReport.peakIncome"),minWidth:120},{align:"center",field:"flatAmount",title:e("system.photovoltaicIncomeReport.flatAmount"),minWidth:120},{align:"center",field:"flatIncome",title:e("system.photovoltaicIncomeReport.flatIncome"),minWidth:120},{align:"center",field:"valleyAmount",title:e("system.photovoltaicIncomeReport.valleyAmount"),minWidth:120},{align:"center",field:"valleyIncome",title:e("system.photovoltaicIncomeReport.valleyIncome"),minWidth:120},{align:"center",field:"deepValleyAmount",title:e("system.photovoltaicIncomeReport.deepValleyAmount"),minWidth:120},{align:"center",field:"deepValleyIncome",title:e("system.photovoltaicIncomeReport.deepValleyIncome"),minWidth:120},{align:"center",field:"consumptionTotalIncome",title:e("system.photovoltaicIncomeReport.consumptionTotalIncome"),minWidth:120}]},{align:"center",title:e("system.photovoltaicIncomeReport.grid"),children:[{align:"center",field:"gridAmount",title:e("system.photovoltaicIncomeReport.gridAmount"),minWidth:120},{align:"center",field:"gridIncome",title:e("system.photovoltaicIncomeReport.gridIncome"),minWidth:120}]},{align:"center",title:e("system.photovoltaicIncomeReport.total"),children:[{align:"center",field:"totalAmount",title:e("system.photovoltaicIncomeReport.totalAmount"),minWidth:120},{align:"center",field:"totalIncome",title:e("system.photovoltaicIncomeReport.totalIncome"),minWidth:120}]}]}const K=E({__name:"index",setup(r){const n=G("monthly");function i(l){return u(this,null,function*(){try{return{items:(yield L(l)).items}}catch(t){return console.error("获取光伏收益报表数据失败:",t),{items:[]}}})}function g(l){const t={time:e("system.photovoltaicIncomeReport.footer.total")};if(l.length===0)return t;const o=l[0];Object.keys(o).forEach(m=>{if(m!=="time"){const y=l.reduce((A,C)=>{const W=Number(C[m])||0;return A+W},0);t[m]=Number(y.toFixed(2))}});const a=l.reduce((m,y)=>{const A=Number(y.totalIncome)||0;return m+A},0);return t.totalIncome=Number(a.toFixed(2)),t}function d(l){const t=l==="monthly";return{collapsed:!1,commonConfig:{componentProps:{class:"w-full"}},fieldMappingTime:[["time",["startTime","endTime"],t?"YYYY-MM-DD":"YYYY-MM"]],schema:[{component:"SearchSelector",fieldName:"enterprise",label:e("system.photovoltaicIncomeReport.form.enterpriseSelect"),componentProps:{class:"w-full sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-sm",placeholder:e("system.photovoltaicIncomeReport.form.enterprisePlaceholder"),searchPlaceholder:e("system.photovoltaicIncomeReport.form.enterpriseSearchPlaceholder"),buttonType:"default",buttonSize:"default",placement:"bottom-start",popoverWidth:300,filterable:!0,remote:!1,dataSource:o=>u(null,null,function*(){try{console.log("SearchSelector dataSource called with keyword:",o);const a=yield q(o||void 0);return console.log("Enterprise list loaded:",a.length,"items"),a}catch(a){console.error("获取企业列表失败:",a);const m=[];return o&&o.trim()?m.filter(y=>y.label.toLowerCase().includes(o.toLowerCase())):(console.log("Using fallback enterprise data:",m.length,"items"),m)}}),onChange:(o,a)=>{console.log("Enterprise selected:",o,a)}}},{component:"RangePicker",defaultValue:t?[R().subtract(7,"days"),R()]:[R().subtract(11,"months").startOf("month"),R().endOf("month")],fieldName:"time",label:t?e("system.photovoltaicIncomeReport.form.dateRange"):e("system.photovoltaicIncomeReport.form.monthRange"),componentProps:{class:"w-full",startPlaceholder:t?e("system.photovoltaicIncomeReport.form.startDate"):e("system.photovoltaicIncomeReport.form.startMonth"),endPlaceholder:t?e("system.photovoltaicIncomeReport.form.endDate"):e("system.photovoltaicIncomeReport.form.endMonth"),rangeSeparator:e("system.photovoltaicIncomeReport.form.separator"),format:t?"YYYY-MM-DD":"YYYY-MM",valueFormat:t?"YYYY-MM-DD":"YYYY-MM",clearable:!0,size:"default",type:t?"daterange":"monthrange"}}],showCollapseButton:!1,submitOnChange:!0,submitOnEnter:!1,layout:"horizontal"}}const f=l=>({columns:U(l),height:"auto",keepSource:!0,showFooter:!0,resizable:!0,autoResize:!0,columnConfig:{resizable:!0,useKey:!0},border:!0,stripe:!0,round:!0,footerData:[{time:e("system.photovoltaicIncomeReport.footer.total"),sharpAmount:0,sharpIncome:0,peakAmount:0,peakIncome:0,flatAmount:0,flatIncome:0,valleyAmount:0,valleyIncome:0,deepValleyAmount:0,deepValleyIncome:0,consumptionTotalIncome:0,gridAmount:0,gridIncome:0,totalAmount:0,totalIncome:0}],pagerConfig:{enabled:!1},rowConfig:{keyField:"time"},toolbarConfig:{search:!1,custom:!0,export:!0,refresh:{code:"query"},zoom:!0}}),[b,p]=M({formOptions:d("monthly"),showSearchForm:!0,gridOptions:T(Y({},f("monthly")),{proxyConfig:{autoLoad:!1,ajax:{query:(l,t)=>u(null,null,function*(){var a;if(console.log("月报搜索参数:",t),!(t!=null&&t.enterprise))return console.log("未选择企业，跳过月报数据查询"),{items:[]};console.log("开始查询月报数据，企业:",t.enterprise);const o=yield i({startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,enterprise:t==null?void 0:t.enterprise,reportType:"monthly"});if(console.log("月报数据查询完成，数据条数:",((a=o.items)==null?void 0:a.length)||0),o.items&&o.items.length>0){const m=g(o.items);p.setGridOptions({footerData:[m]})}return o})}}})}),[s,h]=M({formOptions:d("yearly"),showSearchForm:!0,gridOptions:T(Y({},f("yearly")),{proxyConfig:{autoLoad:!1,ajax:{query:(l,t)=>u(null,null,function*(){var a;if(console.log("年报搜索参数:",t),!(t!=null&&t.enterprise))return console.log("未选择企业，跳过年报数据查询"),{items:[]};console.log("开始查询年报数据，企业:",t.enterprise);const o=yield i({startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,enterprise:t==null?void 0:t.enterprise,reportType:"yearly"});if(console.log("年报数据查询完成，数据条数:",((a=o.items)==null?void 0:a.length)||0),o.items&&o.items.length>0){const m=g(o.items);h.setGridOptions({footerData:[m]})}return o})}}})});return z(n,l=>{setTimeout(()=>{l==="monthly"?p.query():h.query()},100)}),(l,t)=>($(),N(c(B),{"auto-content-height":""},{default:v(()=>[I(c(j),{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),"tab-position":"left",class:"photovoltaic-income-report-tabs"},{default:v(()=>[I(c(_),{label:c(e)("system.photovoltaicIncomeReport.tabs.monthly"),name:"monthly"},{default:v(()=>[I(c(b),{"table-title":`${c(e)("system.photovoltaicIncomeReport.title")} - ${c(e)("system.photovoltaicIncomeReport.tabs.monthly")}`,"table-title-help":c(e)("system.photovoltaicIncomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"]),I(c(_),{label:c(e)("system.photovoltaicIncomeReport.tabs.yearly"),name:"yearly"},{default:v(()=>[I(c(s),{"table-title":`${c(e)("system.photovoltaicIncomeReport.title")} - ${c(e)("system.photovoltaicIncomeReport.tabs.yearly")}`,"table-title-help":c(e)("system.photovoltaicIncomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}))}}),ut=k(K,[["__scopeId","data-v-d398e6f3"]]);export{ut as default};
