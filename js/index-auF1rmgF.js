var N=Object.defineProperty,O=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(a,r,o)=>r in a?N(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o,P=(a,r)=>{for(var o in r||(r={}))k.call(r,o)&&A(a,o,r[o]);if(x)for(var o of x(r))G.call(r,o)&&A(a,o,r[o]);return a},Y=(a,r)=>O(a,W(r));var f=(a,r,o)=>new Promise((h,d)=>{var y=s=>{try{g(o.next(s))}catch(u){d(u)}},I=s=>{try{g(o.throw(s))}catch(u){d(u)}},g=s=>s.done?h(s.value):Promise.resolve(s.value).then(y,I);g((o=o.apply(a,r)).next())});import{$ as t,_ as v}from"./bootstrap-CRMPbCAg.js";import{e as E,r as z,w as $,v as j,j as q,I as R,y as b,u as l,a0 as C}from"../jse/index-index-BLEn1CMS.js";import{E as L,a as S,s as B}from"./enterprise-DJBlpcZc.js";import{u as _}from"./vxe-table-3fC9prEm.js";import{b as U}from"./report-CnS7i5P4.js";import{_ as K}from"./page.vue_vue_type_script_setup_true_lang-Jfv2R4fZ.js";import"./error-Cq9Fpw4b.js";import"./strings-BXOxzJ4d.js";import"./event-BB_Ol6Sd.js";import"./vnode-En5plHQE.js";import"./loading-BJEPGsK4.js";import"./css-Y7-lT1k2.js";import"./index-DVO058gF.js";import"./debounce-DNXs5Rvf.js";import"./index-CQxSKuWz.js";import"./scroll-xfvYtqVg.js";import"./index-BBB7ueyP.js";import"./index-DVi7n050.js";import"./use-form-item-C8EWOxB0.js";import"./use-form-common-props-H4BW1-Nh.js";function H(a="monthly",r){return[{align:"center",field:"time",fixed:"left",title:a==="monthly"?t("system.incomeReport.date"):t("system.incomeReport.month"),width:120},{align:"center",title:t("system.incomeReport.solarIncome"),children:[{align:"center",field:"solarConsumptionAmount",title:t("system.incomeReport.consumptionAmount"),minWidth:120},{align:"center",field:"solarGridConnectionAmount",title:t("system.incomeReport.gridConnectionAmount"),minWidth:120},{align:"center",field:"solarIncome",title:t("system.incomeReport.income"),minWidth:100}]},{align:"center",title:t("system.incomeReport.chargingPile"),children:[{align:"center",field:"chargingPileAmount",title:t("system.incomeReport.electricityAmount"),minWidth:120},{align:"center",field:"chargingPileIncome",title:t("system.incomeReport.chargingPileIncome"),minWidth:100}]},{align:"center",title:t("system.incomeReport.storageIncome"),children:[{align:"center",field:"storageChargeAmount",title:t("system.incomeReport.chargeAmount"),minWidth:120},{align:"center",field:"storageDischargeAmount",title:t("system.incomeReport.dischargeAmount"),minWidth:120},{align:"center",field:"storageIncomeTotal",title:t("system.incomeReport.storageIncomeAmount"),minWidth:100}]},{align:"center",title:t("system.incomeReport.windPower"),children:[{align:"center",field:"windConsumptionAmount",title:t("system.incomeReport.windConsumptionAmount"),minWidth:120},{align:"center",field:"windGridConnectionAmount",title:t("system.incomeReport.windGridConnectionAmount"),minWidth:120},{align:"center",field:"windIncome",title:t("system.incomeReport.windIncomeAmount"),minWidth:100}]},{align:"center",title:t("system.incomeReport.totalIncome"),children:[{align:"center",field:"calculatedTotalIncome",title:t("system.incomeReport.totalIncomeAmount"),minWidth:120,formatter:({row:o})=>{const h=Number(o.solarIncome)||0,d=Number(o.chargingPileIncome)||0,y=Number(o.storageIncomeTotal)||0,I=Number(o.windIncome)||0;return(h+d+y+I).toFixed(2)}}]}]}const J=E({__name:"index",setup(a){const r=z("monthly");function o(i){return f(this,null,function*(){try{return{items:(yield U(i)).items}}catch(e){return console.error("获取企业收益报表数据失败:",e),{items:[]}}})}function h(i){const e={time:t("system.incomeReport.footer.total")};if(i.length===0)return e;const n=i[0];Object.keys(n).forEach(m=>{if(m!=="time"){const p=i.reduce((T,w)=>{const D=Number(w[m])||0;return T+D},0);e[m]=Number(p.toFixed(2))}});const c=i.reduce((m,p)=>{const T=Number(p.solarIncome)||0,w=Number(p.chargingPileIncome)||0,D=Number(p.storageIncomeTotal)||0,F=Number(p.windIncome)||0,M=T+w+D+F;return m+M},0);return e.calculatedTotalIncome=Number(c.toFixed(2)),e}function d(i){const e=i==="monthly";return{collapsed:!1,commonConfig:{componentProps:{class:"w-full"}},fieldMappingTime:[["time",["startTime","endTime"],e?"YYYY-MM-DD":"YYYY-MM"]],schema:[{component:"SearchSelector",fieldName:"enterprise",label:t("system.incomeReport.form.enterpriseSelect"),componentProps:{class:"w-full sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-sm",placeholder:t("system.incomeReport.form.enterprisePlaceholder"),searchPlaceholder:t("system.incomeReport.form.enterpriseSearchPlaceholder"),buttonType:"default",buttonSize:"default",placement:"bottom-start",popoverWidth:300,filterable:!0,remote:!1,dataSource:n=>f(null,null,function*(){try{console.log("SearchSelector dataSource called with keyword:",n);const c=yield B(n||void 0);return console.log("Enterprise list loaded:",c.length,"items"),c}catch(c){console.error("获取企业列表失败:",c);const m=[];return n&&n.trim()?m.filter(p=>p.label.toLowerCase().includes(n.toLowerCase())):(console.log("Using fallback enterprise data:",m.length,"items"),m)}}),onChange:(n,c)=>{console.log("Enterprise selected:",n,c)}}},{component:"RangePicker",defaultValue:e?[C().subtract(7,"days"),C()]:[C().subtract(11,"months").startOf("month"),C().endOf("month")],fieldName:"time",label:e?t("system.incomeReport.form.dateRange"):t("system.incomeReport.form.monthRange"),componentProps:{class:"w-full",startPlaceholder:e?t("system.incomeReport.form.startDate"):t("system.incomeReport.form.startMonth"),endPlaceholder:e?t("system.incomeReport.form.endDate"):t("system.incomeReport.form.endMonth"),rangeSeparator:t("system.incomeReport.form.separator"),format:e?"YYYY-MM-DD":"YYYY-MM",valueFormat:e?"YYYY-MM-DD":"YYYY-MM",clearable:!0,size:"default",type:e?"daterange":"monthrange"}}],showCollapseButton:!1,submitOnChange:!0,submitOnEnter:!1,layout:"horizontal"}}const y=i=>({columns:H(i),height:"auto",keepSource:!0,showFooter:!0,resizable:!0,autoResize:!0,columnConfig:{resizable:!0,useKey:!0},border:!0,stripe:!0,round:!0,footerData:[{time:t("system.incomeReport.footer.total"),electricityIncomeSharp:0,electricityIncomePeak:0,electricityIncomeFlat:0,electricityIncomeValley:0,electricityIncomeDeepValley:0,electricityIncomeTotal:0,windIncomeSharp:0,windIncomePeak:0,windIncomeFlat:0,windIncomeValley:0,windIncomeDeepValley:0,windIncomeTotal:0,storageChargeIncomeSharp:0,storageChargeIncomePeak:0,storageChargeIncomeFlat:0,storageChargeIncomeValley:0,storageChargeIncomeDeepValley:0,storageChargeIncomeTotal:0,storageDischargeIncomeSharp:0,storageDischargeIncomePeak:0,storageDischargeIncomeFlat:0,storageDischargeIncomeValley:0,storageDischargeIncomeDeepValley:0,storageDischargeIncomeTotal:0,chargingIncomeSharp:0,chargingIncomePeak:0,chargingIncomeFlat:0,chargingIncomeValley:0,chargingIncomeDeepValley:0,chargingIncomeTotal:0,gridIncomeSharp:0,gridIncomePeak:0,gridIncomeFlat:0,gridIncomeValley:0,gridIncomeDeepValley:0,gridIncomeTotal:0,solarConsumptionIncomeSharp:0,solarConsumptionIncomePeak:0,solarConsumptionIncomeFlat:0,solarConsumptionIncomeValley:0,solarConsumptionIncomeDeepValley:0,solarConsumptionIncomeTotal:0,gridConnectionIncome:0,grandTotalIncome:0}],pagerConfig:{enabled:!1},rowConfig:{keyField:"time"},toolbarConfig:{search:!1,custom:!0,export:!0,refresh:{code:"query"},zoom:!0}}),[I,g]=_({formOptions:d("monthly"),showSearchForm:!0,gridOptions:Y(P({},y("monthly")),{proxyConfig:{autoLoad:!1,ajax:{query:(i,e)=>f(null,null,function*(){var c;if(console.log("月报搜索参数:",e),!(e!=null&&e.enterprise))return console.log("未选择企业，跳过月报数据查询"),{items:[]};console.log("开始查询月报数据，企业:",e.enterprise);const n=yield o({startTime:e==null?void 0:e.startTime,endTime:e==null?void 0:e.endTime,enterprise:e==null?void 0:e.enterprise,reportType:"monthly"});if(console.log("月报数据查询完成，数据条数:",((c=n.items)==null?void 0:c.length)||0),n.items&&n.items.length>0){const m=h(n.items);g.setGridOptions({footerData:[m]})}return n})}}})}),[s,u]=_({formOptions:d("yearly"),showSearchForm:!0,gridOptions:Y(P({},y("yearly")),{proxyConfig:{autoLoad:!1,ajax:{query:(i,e)=>f(null,null,function*(){var c;if(console.log("年报搜索参数:",e),!(e!=null&&e.enterprise))return console.log("未选择企业，跳过年报数据查询"),{items:[]};console.log("开始查询年报数据，企业:",e.enterprise);const n=yield o({startTime:e==null?void 0:e.startTime,endTime:e==null?void 0:e.endTime,enterprise:e==null?void 0:e.enterprise,reportType:"yearly"});if(console.log("年报数据查询完成，数据条数:",((c=n.items)==null?void 0:c.length)||0),n.items&&n.items.length>0){const m=h(n.items);u.setGridOptions({footerData:[m]})}return n})}}})});return $(r,i=>{setTimeout(()=>{i==="monthly"?g.query():u.query()},100)}),(i,e)=>(q(),j(l(K),{"auto-content-height":""},{default:R(()=>[b(l(L),{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),"tab-position":"left",class:"income-report-tabs"},{default:R(()=>[b(l(S),{label:l(t)("system.incomeReport.tabs.monthly"),name:"monthly"},{default:R(()=>[b(l(I),{"table-title":`${l(t)("system.incomeReport.title")} - ${l(t)("system.incomeReport.tabs.monthly")}`,"table-title-help":l(t)("system.incomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"]),b(l(S),{label:l(t)("system.incomeReport.tabs.yearly"),name:"yearly"},{default:R(()=>[b(l(s),{"table-title":`${l(t)("system.incomeReport.title")} - ${l(t)("system.incomeReport.tabs.yearly")}`,"table-title-help":l(t)("system.incomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}))}}),Ie=v(J,[["__scopeId","data-v-27cda6f9"]]);export{Ie as default};
