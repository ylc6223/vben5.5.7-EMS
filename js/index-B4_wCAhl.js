var M=Object.defineProperty,O=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var v=(c,n,a)=>n in c?M(c,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[n]=a,_=(c,n)=>{for(var a in n||(n={}))G.call(n,a)&&v(c,a,n[a]);if(P)for(var a of P(n))z.call(n,a)&&v(c,a,n[a]);return c},x=(c,n)=>O(c,$(n));var S=(c,n,a)=>new Promise((u,I)=>{var E=g=>{try{h(a.next(g))}catch(d){I(d)}},R=g=>{try{h(a.throw(g))}catch(d){I(d)}},h=g=>g.done?u(g.value):Promise.resolve(g.value).then(E,R);h((a=a.apply(c,n)).next())});import{$ as r,_ as j}from"./bootstrap-DKNppDM-.js";import{e as q,r as D,w as A,v as B,j as L,I as p,y as m,u as l,l as f,a0 as C}from"../jse/index-index-CClcjv6z.js";import{E as U,a as w,s as V}from"./enterprise-CIYm-gLL.js";import{u as Y}from"./vxe-table-BySml_v5.js";import{a as K}from"./report-DfgTrm3o.js";import{_ as k}from"./energy-storage-income-chart.vue_vue_type_script_setup_true_lang-6qzgoRCT.js";import{_ as W}from"./analysis-chart-card.vue_vue_type_script_setup_true_lang-NJj6wFQc.js";import{_ as H}from"./page.vue_vue_type_script_setup_true_lang-DC8d8YcG.js";import"./error-Cq9Fpw4b.js";import"./strings-CjSmUTd0.js";import"./event-BB_Ol6Sd.js";import"./vnode-DrRWajJj.js";import"./loading-CMDzNo7D.js";import"./css-B_CDxaI0.js";import"./index-DbQGFv3H.js";import"./debounce-Cbv_-rf3.js";import"./index-C7broldF.js";import"./scroll-MnIlRsTY.js";import"./index-CB6HUdZy.js";import"./index-BLKRwB_-.js";import"./use-form-item-94WQABG4.js";import"./use-form-common-props-CFNhUBoH.js";import"./use-echarts-CEbmR3WJ.js";function J(c="monthly",n){return[{align:"center",field:"time",fixed:"left",title:c==="monthly"?r("system.energyStorageIncomeReport.date"):r("system.energyStorageIncomeReport.month"),width:120},{align:"center",title:r("system.energyStorageIncomeReport.chargingElectricity"),children:[{align:"center",field:"chargingElectricitySharp",title:r("system.energyStorageIncomeReport.sharp"),minWidth:100},{align:"center",field:"chargingElectricityPeak",title:r("system.energyStorageIncomeReport.peak"),minWidth:100},{align:"center",field:"chargingElectricityFlat",title:r("system.energyStorageIncomeReport.flat"),minWidth:100},{align:"center",field:"chargingElectricityValley",title:r("system.energyStorageIncomeReport.valley"),minWidth:100},{align:"center",field:"chargingElectricityDeepValley",title:r("system.energyStorageIncomeReport.deepValley"),minWidth:100}]},{align:"center",title:r("system.energyStorageIncomeReport.dischargingElectricity"),children:[{align:"center",field:"dischargingElectricitySharp",title:r("system.energyStorageIncomeReport.sharp"),minWidth:100},{align:"center",field:"dischargingElectricityPeak",title:r("system.energyStorageIncomeReport.peak"),minWidth:100},{align:"center",field:"dischargingElectricityFlat",title:r("system.energyStorageIncomeReport.flat"),minWidth:100},{align:"center",field:"dischargingElectricityValley",title:r("system.energyStorageIncomeReport.valley"),minWidth:100},{align:"center",field:"dischargingElectricityDeepValley",title:r("system.energyStorageIncomeReport.deepValley"),minWidth:100}]},{align:"center",title:r("system.energyStorageIncomeReport.chargingCost"),children:[{align:"center",field:"chargingCostSharp",title:r("system.energyStorageIncomeReport.sharp"),minWidth:100},{align:"center",field:"chargingCostPeak",title:r("system.energyStorageIncomeReport.peak"),minWidth:100},{align:"center",field:"chargingCostFlat",title:r("system.energyStorageIncomeReport.flat"),minWidth:100},{align:"center",field:"chargingCostValley",title:r("system.energyStorageIncomeReport.valley"),minWidth:100},{align:"center",field:"chargingCostDeepValley",title:r("system.energyStorageIncomeReport.deepValley"),minWidth:100}]},{align:"center",title:r("system.energyStorageIncomeReport.dischargingIncome"),children:[{align:"center",field:"dischargingIncomeSharp",title:r("system.energyStorageIncomeReport.sharp"),minWidth:100},{align:"center",field:"dischargingIncomePeak",title:r("system.energyStorageIncomeReport.peak"),minWidth:100},{align:"center",field:"dischargingIncomeFlat",title:r("system.energyStorageIncomeReport.flat"),minWidth:100},{align:"center",field:"dischargingIncomeValley",title:r("system.energyStorageIncomeReport.valley"),minWidth:100},{align:"center",field:"dischargingIncomeDeepValley",title:r("system.energyStorageIncomeReport.deepValley"),minWidth:100}]},{align:"center",field:"totalNetIncome",title:r("system.energyStorageIncomeReport.totalNetIncome"),minWidth:120,formatter:({row:a})=>(Number(a.totalNetIncome)||0).toFixed(2)}]}const Q={class:"h-[66%] overflow-hidden"},X={class:"flex h-[33%] flex-col"},Z={class:"h-full flex-1"},ee={class:"h-[66%] overflow-hidden"},te={class:"flex h-[33%] flex-col"},re={class:"h-full flex-1"},ie=q({__name:"index",setup(c){const n=D("monthly"),a=D([]),u=D([]);function I(s){return S(this,null,function*(){try{return{items:(yield K(s)).items}}catch(t){return console.error("获取储能收益报表数据失败:",t),{items:[]}}})}function E(s){const t={time:r("system.energyStorageIncomeReport.footer.total")};if(s.length===0)return t;const i=s[0];return Object.keys(i).forEach(o=>{if(o!=="time"){const y=s.reduce((e,b)=>{const T=Number(b[o])||0;return e+T},0);t[o]=Number(y.toFixed(2))}}),t}function R(s){const t=s==="monthly";return{collapsed:!1,commonConfig:{componentProps:{class:"w-full"}},fieldMappingTime:[["time",["startTime","endTime"],t?"YYYY-MM-DD":"YYYY-MM"]],schema:[{component:"SearchSelector",fieldName:"enterprise",label:r("system.energyStorageIncomeReport.form.enterpriseSelect"),componentProps:{class:"w-full sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-sm",placeholder:r("system.energyStorageIncomeReport.form.enterprisePlaceholder"),searchPlaceholder:r("system.energyStorageIncomeReport.form.enterpriseSearchPlaceholder"),buttonType:"default",buttonSize:"default",placement:"bottom-start",popoverWidth:300,filterable:!0,remote:!1,dataSource:i=>S(null,null,function*(){try{console.log("SearchSelector dataSource called with keyword:",i);const o=yield V(i||void 0);return console.log("Enterprise list loaded:",o.length,"items"),o}catch(o){console.error("获取企业列表失败:",o);const y=[];return i&&i.trim()?y.filter(e=>e.label.toLowerCase().includes(i.toLowerCase())):(console.log("Using fallback enterprise data:",y.length,"items"),y)}}),onChange:(i,o)=>{console.log("Enterprise selected:",i,o)}}},{component:"RangePicker",defaultValue:t?[C().subtract(7,"days"),C()]:[C().subtract(11,"months").startOf("month"),C().endOf("month")],fieldName:"time",label:t?r("system.energyStorageIncomeReport.form.dateRange"):r("system.energyStorageIncomeReport.form.monthRange"),componentProps:{class:"w-full",startPlaceholder:t?r("system.energyStorageIncomeReport.form.startDate"):r("system.energyStorageIncomeReport.form.startMonth"),endPlaceholder:t?r("system.energyStorageIncomeReport.form.endDate"):r("system.energyStorageIncomeReport.form.endMonth"),rangeSeparator:r("system.energyStorageIncomeReport.form.separator"),format:t?"YYYY-MM-DD":"YYYY-MM",valueFormat:t?"YYYY-MM-DD":"YYYY-MM",clearable:!0,size:"default",type:t?"daterange":"monthrange"}}],showCollapseButton:!1,submitOnChange:!0,submitOnEnter:!1,layout:"horizontal"}}const h=s=>({columns:J(s),height:"auto",keepSource:!0,showFooter:!0,resizable:!0,autoResize:!0,columnConfig:{resizable:!0,useKey:!0},border:!0,stripe:!0,round:!0,footerData:[{time:r("system.energyStorageIncomeReport.footer.total"),chargingElectricitySharp:0,chargingElectricityPeak:0,chargingElectricityFlat:0,chargingElectricityValley:0,chargingElectricityDeepValley:0,dischargingElectricitySharp:0,dischargingElectricityPeak:0,dischargingElectricityFlat:0,dischargingElectricityValley:0,dischargingElectricityDeepValley:0,chargingCostSharp:0,chargingCostPeak:0,chargingCostFlat:0,chargingCostValley:0,chargingCostDeepValley:0,dischargingIncomeSharp:0,dischargingIncomePeak:0,dischargingIncomeFlat:0,dischargingIncomeValley:0,dischargingIncomeDeepValley:0,totalNetIncome:0}],pagerConfig:{enabled:!1},rowConfig:{keyField:"time"},toolbarConfig:{search:!1,custom:!0,export:!0,refresh:{code:"query"},zoom:!0}}),[g,d]=Y({formOptions:R("monthly"),showSearchForm:!0,gridOptions:x(_({},h("monthly")),{proxyConfig:{autoLoad:!1,ajax:{query:(s,t)=>S(null,null,function*(){var o;if(console.log("月报搜索参数:",t),!(t!=null&&t.enterprise))return console.log("未选择企业，跳过月报数据查询"),{items:[]};console.log("开始查询月报数据，企业:",t.enterprise);const i=yield I({startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,enterprise:t==null?void 0:t.enterprise,reportType:"monthly"});if(console.log("月报数据查询完成，数据条数:",((o=i.items)==null?void 0:o.length)||0),i.items&&i.items.length>0){const y=E(i.items);d.setGridOptions({footerData:[y]}),a.value=i.items.map(e=>{const b={time:e.time,totalChargingElectricity:Number(((e.chargingElectricitySharp||0)+(e.chargingElectricityPeak||0)+(e.chargingElectricityFlat||0)+(e.chargingElectricityValley||0)+(e.chargingElectricityDeepValley||0)).toFixed(2)),totalDischargingElectricity:Number(((e.dischargingElectricitySharp||0)+(e.dischargingElectricityPeak||0)+(e.dischargingElectricityFlat||0)+(e.dischargingElectricityValley||0)+(e.dischargingElectricityDeepValley||0)).toFixed(2)),totalChargingCost:Number(((e.chargingCostSharp||0)+(e.chargingCostPeak||0)+(e.chargingCostFlat||0)+(e.chargingCostValley||0)+(e.chargingCostDeepValley||0)).toFixed(2)),totalDischargingIncome:Number(((e.dischargingIncomeSharp||0)+(e.dischargingIncomePeak||0)+(e.dischargingIncomeFlat||0)+(e.dischargingIncomeValley||0)+(e.dischargingIncomeDeepValley||0)).toFixed(2))};return console.log("月报数据项:",{time:e.time,原始数据:e,计算结果:b}),b})}return i})}}})}),[N,F]=Y({formOptions:R("yearly"),showSearchForm:!0,gridOptions:x(_({},h("yearly")),{proxyConfig:{autoLoad:!1,ajax:{query:(s,t)=>S(null,null,function*(){var o;if(console.log("年报搜索参数:",t),!(t!=null&&t.enterprise))return console.log("未选择企业，跳过年报数据查询"),{items:[]};console.log("开始查询年报数据，企业:",t.enterprise);const i=yield I({startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,enterprise:t==null?void 0:t.enterprise,reportType:"yearly"});if(console.log("年报数据查询完成，数据条数:",((o=i.items)==null?void 0:o.length)||0),i.items&&i.items.length>0){const y=E(i.items);F.setGridOptions({footerData:[y]}),u.value=i.items.map(e=>({time:e.time,totalChargingElectricity:Number(((e.chargingElectricitySharp||0)+(e.chargingElectricityPeak||0)+(e.chargingElectricityFlat||0)+(e.chargingElectricityValley||0)+(e.chargingElectricityDeepValley||0)).toFixed(2)),totalDischargingElectricity:Number(((e.dischargingElectricitySharp||0)+(e.dischargingElectricityPeak||0)+(e.dischargingElectricityFlat||0)+(e.dischargingElectricityValley||0)+(e.dischargingElectricityDeepValley||0)).toFixed(2)),totalChargingCost:Number(((e.chargingCostSharp||0)+(e.chargingCostPeak||0)+(e.chargingCostFlat||0)+(e.chargingCostValley||0)+(e.chargingCostDeepValley||0)).toFixed(2)),totalDischargingIncome:Number(((e.dischargingIncomeSharp||0)+(e.dischargingIncomePeak||0)+(e.dischargingIncomeFlat||0)+(e.dischargingIncomeValley||0)+(e.dischargingIncomeDeepValley||0)).toFixed(2))}))}return i})}}})});return A(n,s=>{setTimeout(()=>{s==="monthly"?d.query():F.query()},100)}),(s,t)=>(L(),B(l(H),{"auto-content-height":""},{default:p(()=>[m(l(U),{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=i=>n.value=i),"tab-position":"left",class:"income-report-tabs"},{default:p(()=>[m(l(w),{label:l(r)("system.energyStorageIncomeReport.tabs.monthly"),name:"monthly"},{default:p(()=>[f("div",Q,[m(l(g),{"table-title":`${l(r)("system.energyStorageIncomeReport.title")} - ${l(r)("system.energyStorageIncomeReport.tabs.monthly")}`,"table-title-help":l(r)("system.energyStorageIncomeReport.description")},null,8,["table-title","table-title-help"])]),f("div",X,[m(l(W),{class:"flex h-full w-full flex-col",title:""},{default:p(()=>[f("div",Z,[m(k,{"report-type":"monthly","chart-data":a.value},null,8,["chart-data"])])]),_:1})])]),_:1},8,["label"]),m(l(w),{label:l(r)("system.energyStorageIncomeReport.tabs.yearly"),name:"yearly"},{default:p(()=>[f("div",ee,[m(l(N),{"table-title":`${l(r)("system.energyStorageIncomeReport.title")} - ${l(r)("system.energyStorageIncomeReport.tabs.yearly")}`,"table-title-help":l(r)("system.energyStorageIncomeReport.description")},null,8,["table-title","table-title-help"])]),f("div",te,[m(l(W),{class:"flex h-full w-full flex-col",title:""},{default:p(()=>[f("div",re,[m(k,{"report-type":"yearly","chart-data":u.value},null,8,["chart-data"])])]),_:1})])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}))}}),Pe=j(ie,[["__scopeId","data-v-f7e05dee"]]);export{Pe as default};
