var L=Object.defineProperty,A=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var x=(i,a,s)=>a in i?L(i,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[a]=s,w=(i,a)=>{for(var s in a||(a={}))_.call(a,s)&&x(i,s,a[s]);if(k)for(var s of k(a))D.call(a,s)&&x(i,s,a[s]);return i},C=(i,a)=>A(i,V(a));var h=(i,a,s)=>new Promise((o,m)=>{var c=u=>{try{y(s.next(u))}catch(d){m(d)}},p=u=>{try{y(s.throw(u))}catch(d){m(d)}},y=u=>u.done?o(u.value):Promise.resolve(u.value).then(c,p);y((s=s.apply(i,a)).next())});import{$ as t,s as b,a4 as E,a7 as B,a8 as O,a9 as W,a5 as q,aa as z,ab as N,p as $,ac as G,ad as H}from"./bootstrap-CRMPbCAg.js";import{e as K,r as F,K as v,Y as j,Z as U,c as I,v as Y,j as Z,I as J,y as Q,u as T}from"../jse/index-index-BLEn1CMS.js";import{u as X}from"./use-drawer-CjwYR-wN.js";function ee(i){var a,s;return(s=(a=i==null?void 0:i.closest("form"))!=null?a:i==null?void 0:i.parentNode)!=null?s:document.body}function S(){return[{color:"processing",label:t("system.menu.typeCatalog"),value:"catalog"},{color:"default",label:t("system.menu.typeMenu"),value:"menu"},{color:"error",label:t("system.menu.typeButton"),value:"button"},{color:"success",label:t("system.menu.typeEmbedded"),value:"embedded"},{color:"warning",label:t("system.menu.typeLink"),value:"link"}]}function le(i){return[{align:"left",field:"meta.title",fixed:"left",slots:{default:"title"},title:t("system.menu.menuTitle"),treeNode:!0,width:250},{align:"center",cellRender:{name:"CellTag",options:S()},field:"type",title:t("system.menu.type"),width:100},{field:"authCode",title:t("system.menu.authCode"),width:200},{align:"left",field:"path",title:t("system.menu.path"),width:200},{align:"left",field:"component",formatter:({row:a})=>{var s,o,m,c,p;switch(a.type){case"catalog":case"menu":return(s=a.component)!=null?s:"";case"embedded":return(m=(o=a.meta)==null?void 0:o.iframeSrc)!=null?m:"";case"link":return(p=(c=a.meta)==null?void 0:c.link)!=null?p:""}return""},minWidth:200,title:t("system.menu.component")},{cellRender:{name:"CellTag"},field:"status",title:t("system.menu.status"),width:100},{align:"right",cellRender:{attrs:{nameField:"name",onClick:i},name:"CellOperation",options:[{code:"append",text:"新增下级"},"edit","delete"]},field:"operation",fixed:"right",headerAlign:"center",showOverflow:!1,title:t("system.menu.operation"),width:200}]}const ie=K({__name:"form",emits:["success"],setup(i,{emit:a}){const s=a,o=F(),m=F(),c=[{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:S(),optionType:"button"},defaultValue:"menu",fieldName:"type",formItemClass:"col-span-2 md:col-span-2",label:t("system.menu.type")},{component:"Input",fieldName:"name",label:t("system.menu.menuName"),rules:b().min(2,t("ui.formRules.minLength",[t("system.menu.menuName"),2])).max(30,t("ui.formRules.maxLength",[t("system.menu.menuName"),30])).refine(e=>h(null,null,function*(){var n;return!(yield W(e,(n=o.value)==null?void 0:n.id))}),e=>({message:t("ui.formRules.alreadyExists",[t("system.menu.menuName"),e])}))},{component:"ApiTreeSelect",componentProps:{api:E,class:"w-full",filterTreeNode(e,n){var f,r;if(!e||e.length===0)return!0;const l=(r=(f=n.meta)==null?void 0:f.title)!=null?r:"";return l?l.includes(e)||t(l).includes(e):!1},getPopupContainer:ee,labelField:"meta.title",showSearch:!0,treeDefaultExpandAll:!0,valueField:"id",childrenField:"children"},fieldName:"pid",label:t("system.menu.parent"),renderComponentContent(){return{title({label:e,meta:n}){const l=[];return e?(n!=null&&n.icon&&l.push(v(q,{class:"size-4",icon:n.icon})),l.push(v("span",{class:""},t(e||""))),v("div",{class:"flex items-center gap-1"},l)):""}}}},{component:"Input",componentProps(){return{addonAfter:m.value,onChange({target:{value:e}}){m.value=e&&z(e)?t(e):void 0}}},fieldName:"meta.title",label:t("system.menu.menuTitle"),rules:"required"},{component:"Input",dependencies:{show:e=>["catalog","embedded","menu"].includes(e.type),triggerFields:["type"]},fieldName:"path",label:t("system.menu.path"),rules:b().min(2,t("ui.formRules.minLength",[t("system.menu.path"),2])).max(100,t("ui.formRules.maxLength",[t("system.menu.path"),100])).refine(e=>e.startsWith("/"),t("ui.formRules.startWith",[t("system.menu.path"),"/"])).refine(e=>h(null,null,function*(){var n;return!(yield N(e,(n=o.value)==null?void 0:n.id))}),e=>({message:t("ui.formRules.alreadyExists",[t("system.menu.path"),e])}))},{component:"Input",dependencies:{show:e=>["embedded","menu"].includes(e.type),triggerFields:["type"]},fieldName:"activePath",help:t("system.menu.activePathHelp"),label:t("system.menu.activePath"),rules:b().min(2,t("ui.formRules.minLength",[t("system.menu.path"),2])).max(100,t("ui.formRules.maxLength",[t("system.menu.path"),100])).refine(e=>e.startsWith("/"),t("ui.formRules.startWith",[t("system.menu.path"),"/"])).refine(e=>h(null,null,function*(){var n;return yield N(e,(n=o.value)==null?void 0:n.id)}),t("system.menu.activePathMustExist")).optional()},{component:"IconPicker",componentProps:{prefix:"carbon"},dependencies:{show:e=>["catalog","embedded","link","menu"].includes(e.type),triggerFields:["type"]},fieldName:"meta.icon",label:t("system.menu.icon")},{component:"IconPicker",componentProps:{prefix:"carbon"},dependencies:{show:e=>["catalog","embedded","menu"].includes(e.type),triggerFields:["type"]},fieldName:"meta.activeIcon",label:t("system.menu.activeIcon")},{component:"AutoComplete",componentProps:{allowClear:!0,class:"w-full",filterOption(e,n){return n.value.toLowerCase().includes(e.toLowerCase())},options:B.map(e=>({value:e}))},dependencies:{rules:e=>e.type==="menu"?"required":null,show:e=>e.type==="menu",triggerFields:["type"]},fieldName:"component",label:t("system.menu.component")},{component:"Input",dependencies:{show:e=>["embedded","link"].includes(e.type),triggerFields:["type"]},fieldName:"linkSrc",label:t("system.menu.linkSrc"),rules:b().url(t("ui.formRules.invalidURL"))},{component:"Input",dependencies:{rules:e=>e.type==="action"?"required":null,show:e=>["action","catalog","embedded","menu"].includes(e.type),triggerFields:["type"]},fieldName:"authCode",label:t("system.menu.authCode")},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:[{label:t("common.enabled"),value:1},{label:t("common.disabled"),value:0}],optionType:"button"},defaultValue:1,fieldName:"status",label:t("system.menu.status")},{component:"Select",componentProps:{allowClear:!0,class:"w-full",options:[{label:t("system.menu.badgeType.dot"),value:"dot"},{label:t("system.menu.badgeType.normal"),value:"normal"}]},dependencies:{show:e=>e.type!=="action",triggerFields:["type"]},fieldName:"meta.badgeType",label:t("system.menu.badgeType.title")},{component:"Input",componentProps:e=>{var n;return{allowClear:!0,class:"w-full",disabled:((n=e.meta)==null?void 0:n.badgeType)!=="normal"}},dependencies:{show:e=>e.type!=="action",triggerFields:["type"]},fieldName:"meta.badge",label:t("system.menu.badge")},{component:"Select",componentProps:{allowClear:!0,class:"w-full",options:O.BadgeVariants.map(e=>({label:e,value:e}))},dependencies:{show:e=>e.type!=="action",triggerFields:["type"]},fieldName:"meta.badgeVariants",label:t("system.menu.badgeVariants")},{component:"Divider",dependencies:{show:e=>!["action","link"].includes(e.type),triggerFields:["type"]},fieldName:"divider1",formItemClass:"col-span-2 md:col-span-2 pb-0",hideLabel:!0,renderComponentContent(){return{default:()=>t("system.menu.advancedSettings")}}},{component:"Checkbox",dependencies:{show:e=>["menu"].includes(e.type),triggerFields:["type"]},fieldName:"meta.keepAlive",renderComponentContent(){return{default:()=>t("system.menu.keepAlive")}}},{component:"Checkbox",dependencies:{show:e=>["embedded","menu"].includes(e.type),triggerFields:["type"]},fieldName:"meta.affixTab",renderComponentContent(){return{default:()=>t("system.menu.affixTab")}}},{component:"Checkbox",dependencies:{show:e=>!["action"].includes(e.type),triggerFields:["type"]},fieldName:"meta.hideInMenu",renderComponentContent(){return{default:()=>t("system.menu.hideInMenu")}}},{component:"Checkbox",dependencies:{show:e=>["catalog","menu"].includes(e.type),triggerFields:["type"]},fieldName:"meta.hideChildrenInMenu",renderComponentContent(){return{default:()=>t("system.menu.hideChildrenInMenu")}}},{component:"Checkbox",dependencies:{show:e=>!["action","link"].includes(e.type),triggerFields:["type"]},fieldName:"meta.hideInBreadcrumb",renderComponentContent(){return{default:()=>t("system.menu.hideInBreadcrumb")}}},{component:"Checkbox",dependencies:{show:e=>!["action","link"].includes(e.type),triggerFields:["type"]},fieldName:"meta.hideInTab",renderComponentContent(){return{default:()=>t("system.menu.hideInTab")}}}],p=j(U),y=I(()=>p.greaterOrEqual("md").value),[u,d]=$({commonConfig:{colon:!0,formItemClass:"col-span-2 md:col-span-1"},schema:c,showDefaultActions:!1,wrapperClass:"grid-cols-2 gap-x-4"}),[P,g]=X({onConfirm:R,onOpenChange(e){var n,l,f;if(e){const r=g.getData();(r==null?void 0:r.type)==="link"?r.linkSrc=(n=r.meta)==null?void 0:n.link:(r==null?void 0:r.type)==="embedded"&&(r.linkSrc=(l=r.meta)==null?void 0:l.iframeSrc),r?(o.value=r,d.setValues(o.value),m.value=(f=o.value.meta)!=null&&f.title?t(o.value.meta.title):""):(d.resetForm(),m.value="")}}});function R(){return h(this,null,function*(){var n;const{valid:e}=yield d.validate();if(e){g.lock();const l=yield d.getValues();l.type==="link"?l.meta=C(w({},l.meta),{link:l.linkSrc}):l.type==="embedded"&&(l.meta=C(w({},l.meta),{iframeSrc:l.linkSrc})),delete l.linkSrc;try{yield(n=o.value)!=null&&n.id?G(o.value.id,l):H(l),g.close(),s("success")}finally{g.unlock()}}})}const M=I(()=>{var e;return(e=o.value)!=null&&e.id?t("ui.actionTitle.edit",[t("system.menu.name")]):t("ui.actionTitle.create",[t("system.menu.name")])});return(e,n)=>(Z(),Y(T(P),{class:"w-full max-w-[800px]",title:M.value},{default:J(()=>[Q(T(u),{class:"mx-4",layout:y.value?"horizontal":"vertical"},null,8,["layout"])]),_:1},8,["title"]))}});export{ie as _,le as u};
