var F=(r,h,C)=>new Promise((t,w)=>{var b=s=>{try{m(C.next(s))}catch(g){w(g)}},v=s=>{try{m(C.throw(s))}catch(g){w(g)}},m=s=>s.done?t(s.value):Promise.resolve(s.value).then(b,v);m((C=C.apply(r,h)).next())});import{aI as Z,aJ as ee,aK as le,n as ae,aL as te,a5 as X,aM as se,_ as x,r as L,$ as l,p as oe,a4 as ne}from"./bootstrap-CRMPbCAg.js";import{e as J,a2 as G,r as V,a3 as ie,o as re,$ as de,v as N,j as p,u as i,n as q,m as U,ai as c,I as T,h as S,k as $,y as j,p as R,z as ue,X as z,l as ce,x as Q,t as W,F as me,c as fe,aj as pe,Q as ve}from"../jse/index-index-BLEn1CMS.js";import{u as ye}from"./use-drawer-CjwYR-wN.js";const he={key:0,class:"w-full"},be={key:1,class:"h-4 w-4"},ge=["onClick"],ke={key:1,class:"w-full"},Ce=J({__name:"tree",props:G({allowClear:{type:Boolean,default:!1},autoCheckParent:{type:Boolean,default:!0},bordered:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},childrenField:{default:"children"},defaultExpandedKeys:{default:()=>[]},defaultExpandedLevel:{default:0},defaultValue:{},disabled:{type:Boolean,default:!1},getNodeClass:{},iconField:{default:"icon"},labelField:{default:"label"},multiple:{type:Boolean,default:!1},showIcon:{type:Boolean,default:!0},transition:{type:Boolean,default:!0},treeData:{},valueField:{default:"value"}},{modelValue:{},modelModifiers:{}}),emits:G(["expand","select"],["update:modelValue"]),setup(r,{expose:h,emit:C}){var O;const t=r,w=C;function b(e,o="children",a=0,n=[]){const y=[];return e.forEach(f=>{const E=c(f,o),_={hasChildren:Array.isArray(E)&&E.length>0,level:a,parents:[...n],value:f};y.push(_),_.hasChildren&&y.push(...b(E,o,a+1,[...n,c(f,t.valueField)]))}),y}const v=V([]),m=ie(r,"modelValue"),s=V((O=t.defaultExpandedKeys)!=null?O:[]),g=V();re(()=>{de(()=>{v.value=b(t.treeData,t.childrenField),I(),t.defaultExpandedLevel!==void 0&&t.defaultExpandedLevel>0&&B(t.defaultExpandedLevel)})});function k(e){var o;return(o=v.value.find(a=>c(a.value,t.valueField)===e))==null?void 0:o.value}function I(){const e=m.value;e===void 0?g.value=void 0:g.value=Array.isArray(e)?e.map(o=>k(o)):k(e)}function M(e){m.value=Array.isArray(e)?e.map(o=>c(o,t.valueField)):c(e,t.valueField)}function B(e){const o=[];v.value.forEach(a=>{a.level<=e-1&&o.push(c(a.value,t.valueField))}),s.value=o}function Y(e){const o=new Set(Array.isArray(e)?e:[e]);s.value=s.value.filter(a=>!o.has(a))}function d(e){[...Array.isArray(e)?e:[e]].forEach(a=>{if(s.value.includes(a))return;k(a)&&s.value.push(a)})}function u(){s.value=v.value.filter(e=>e.hasChildren).map(e=>c(e.value,t.valueField))}function A(){s.value=[]}function P(e){w("expand",e)}function D(e,o){var a,n;!t.checkStrictly&&t.multiple&&t.autoCheckParent&&o&&((n=(a=v.value.find(y=>c(y.value,t.valueField)===c(e.value,t.valueField)))==null?void 0:a.parents)==null||n.forEach(y=>{Array.isArray(m.value)&&!m.value.includes(y)&&m.value.push(y)})),I(),w("select",e)}return h({collapseAll:A,collapseNodes:Y,expandAll:u,expandNodes:d,expandToLevel:B,getItemByValue:k}),(e,o)=>(p(),N(i(Z),{"get-key":a=>i(c)(a,e.valueField),"get-children":a=>i(c)(a,e.childrenField),items:e.treeData,"model-value":g.value,expanded:s.value,"onUpdate:expanded":o[0]||(o[0]=a=>s.value=a),"default-expanded":e.defaultExpandedKeys,"propagate-select":!e.checkStrictly,multiple:e.multiple,disabled:e.disabled,"selection-behavior":e.allowClear||e.multiple?"toggle":"replace","onUpdate:modelValue":M,class:q(i(U)("text-blackA11 container select-none list-none rounded-lg p-2 text-sm font-medium",e.$attrs.class,e.bordered?"border":""))},{default:T(({flattenItems:a})=>[e.$slots.header?(p(),S("div",he,[R(e.$slots,"header",{},void 0,!0)])):$("",!0),j(se,{name:e.transition?"fade":""},{default:T(()=>[(p(!0),S(me,null,ue(a,n=>{var y;return p(),N(i(ee),z({key:n._id,style:{"padding-left":`${n.level-.5}rem`},class:i(U)("cursor-pointer",(y=e.getNodeClass)==null?void 0:y.call(e,n),{"data-[selected]:bg-accent":!e.multiple,"cursor-not-allowed":e.disabled}),ref_for:!0},Object.assign(n.bind,{onfocus:e.disabled?"this.blur()":void 0}),{onSelect:f=>{f.detail.originalEvent.type==="click"&&f.preventDefault(),!e.disabled&&D(n,f.detail.isSelected)},onToggle:f=>{f.detail.originalEvent.type==="click"&&f.preventDefault(),!e.disabled&&P(n)},class:"tree-node focus:ring-grass8 my-0.5 flex items-center rounded px-2 py-1 outline-none focus:ring-2"}),{default:T(({isExpanded:f,isSelected:E,isIndeterminate:_,handleSelect:K,handleToggle:H})=>[n.hasChildren?(p(),N(i(le),{key:0,class:q(["size-4 cursor-pointer transition",{"rotate-90":f}]),onClick:ae(()=>{H(),P(n)},["stop"])},null,8,["class","onClick"])):(p(),S("div",be)),e.multiple?(p(),N(i(te),{key:2,checked:E,disabled:e.disabled,indeterminate:_,onClick:()=>{!e.disabled&&K()}},null,8,["checked","disabled","indeterminate","onClick"])):$("",!0),ce("div",{class:"flex items-center gap-1 pl-2",onClick:Ee=>{!e.disabled&&K()}},[R(e.$slots,"node",z({ref_for:!0},n),()=>[e.showIcon&&i(c)(n.value,e.iconField)?(p(),N(i(X),{key:0,class:"size-4",icon:i(c)(n.value,e.iconField)},null,8,["icon"])):$("",!0),Q(" "+W(i(c)(n.value,e.labelField)),1)],!0)],8,ge)]),_:2},1040,["style","class","onSelect","onToggle"])}),128))]),_:2},1032,["name"]),e.$slots.footer?(p(),S("div",ke,[R(e.$slots,"footer",{},void 0,!0)])):$("",!0)]),_:3},8,["get-key","get-children","items","model-value","expanded","default-expanded","propagate-select","multiple","disabled","selection-behavior","class"]))}}),we=x(Ce,[["__scopeId","data-v-98262614"]]);function Pe(r){return F(this,null,function*(){return L.get("/system/role/list",{params:r})})}function Fe(r){return F(this,null,function*(){return L.post("/system/role",r)})}function Ne(r,h){return F(this,null,function*(){return L.put(`/system/role/${r}`,h)})}function _e(r){return F(this,null,function*(){return L.delete(`/system/role/${r}`)})}function Ve(){return[{component:"Input",fieldName:"name",label:l("system.role.roleName"),rules:"required"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:[{label:l("common.enabled"),value:1},{label:l("common.disabled"),value:0}],optionType:"button"},defaultValue:1,fieldName:"status",label:l("system.role.status")},{component:"Textarea",fieldName:"remark",label:l("system.role.remark")},{component:"Input",fieldName:"permissions",formItemClass:"items-start",label:l("system.role.setPermissions"),modelPropName:"modelValue"}]}function Le(){return[{component:"Input",fieldName:"name",label:l("system.role.roleName")},{component:"Input",fieldName:"id",label:l("system.role.id")},{component:"Select",componentProps:{allowClear:!0,options:[{label:l("common.enabled"),value:1},{label:l("common.disabled"),value:0}]},fieldName:"status",label:l("system.role.status")},{component:"Input",fieldName:"remark",label:l("system.role.remark")},{component:"RangePicker",fieldName:"createTime",label:l("system.role.createTime")}]}function Me(r,h){return[{field:"name",title:l("system.role.roleName"),width:200},{field:"id",title:l("system.role.id"),width:200},{cellRender:{attrs:{beforeChange:h},name:h?"CellSwitch":"CellTag"},field:"status",title:l("system.role.status"),width:100},{field:"remark",minWidth:100,title:l("system.role.remark")},{field:"createTime",title:l("system.role.createTime"),width:200},{align:"center",cellRender:{attrs:{nameField:"name",nameTitle:l("system.role.name"),onClick:r},name:"CellOperation"},field:"operation",fixed:"right",title:l("system.role.operation"),width:130}]}const Ae={class:"w-full"},Te=J({__name:"form",emits:["success"],setup(r,{emit:h}){const C=h,t=V(),[w,b]=oe({schema:Ve(),showDefaultActions:!1}),v=V([]),m=V(!1),s=V(),[g,k]=ye({onConfirm(){return F(this,null,function*(){const{valid:d}=yield b.validate();if(!d)return;const u=yield b.getValues();k.lock(),(s.value?Ne(s.value,u):Fe(u)).then(()=>{C("success"),k.close()}).catch(()=>{k.unlock()})})},onOpenChange(d){if(d){const u=k.getData();b.resetForm(),u?(t.value=u,s.value=u.id,b.setValues(u)):s.value=void 0,v.value.length===0&&I()}}});function I(){return F(this,null,function*(){m.value=!0;try{const d=yield ne();v.value=d}finally{m.value=!1}})}const M=fe(()=>{var d;return(d=t.value)!=null&&d.id?l("common.edit",l("system.role.name")):l("common.create",l("system.role.name"))});function B(d){var A;const u=[];return((A=d.value)==null?void 0:A.type)==="button"&&(u.push("inline-flex"),d.index%3>=1&&u.push("!pl-0")),u.join(" ")}return(d,u)=>{const A=pe("spinning");return p(),N(i(g),{title:M.value},{default:T(()=>[j(i(w),null,{permissions:T(P=>[ve((p(),S("div",Ae,[j(i(we),z({"tree-data":v.value,multiple:"",bordered:"","default-expanded-level":2,"get-node-class":B},P,{"value-field":"id","label-field":"meta.title","icon-field":"meta.icon"}),{node:T(({value:D})=>[D.meta.icon?(p(),N(i(X),{key:0,icon:D.meta.icon},null,8,["icon"])):$("",!0),Q(" "+W(i(l)(D.meta.title)),1)]),_:2},1040,["tree-data"])])),[[A,m.value]])]),_:1})]),_:1},8,["title"])}}}),De=x(Te,[["__scopeId","data-v-bc0eecb9"]]),Re=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{De as F,Le as a,Ne as b,_e as d,Re as f,Pe as g,Me as u};
