var _=Object.defineProperty,M=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var T=(a,l,i)=>l in a?_(a,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[l]=i,D=(a,l)=>{for(var i in l||(l={}))O.call(l,i)&&T(a,i,l[i]);if(P)for(var i of P(l))E.call(l,i)&&T(a,i,l[i]);return a},b=(a,l)=>M(a,v(l));var m=(a,l,i)=>new Promise((f,c)=>{var R=g=>{try{p(i.next(g))}catch(d){c(d)}},u=g=>{try{p(i.throw(g))}catch(d){c(d)}},p=g=>g.done?f(g.value):Promise.resolve(g.value).then(R,u);p((i=i.apply(a,l)).next())});import{r as G,$ as e,_ as $}from"./bootstrap-DKNppDM-.js";import{e as q,r as j,w as A,v as N,j as z,I as w,y as h,u as s,a0 as S}from"../jse/index-index-CClcjv6z.js";import{E as L,a as k,s as B}from"./enterprise-CIYm-gLL.js";import{u as Y}from"./vxe-table-BySml_v5.js";import{_ as I}from"./page.vue_vue_type_script_setup_true_lang-DC8d8YcG.js";import"./error-Cq9Fpw4b.js";import"./strings-CjSmUTd0.js";import"./event-BB_Ol6Sd.js";import"./vnode-DrRWajJj.js";import"./loading-CMDzNo7D.js";import"./css-B_CDxaI0.js";import"./index-DbQGFv3H.js";import"./debounce-Cbv_-rf3.js";import"./index-C7broldF.js";import"./scroll-MnIlRsTY.js";import"./index-CB6HUdZy.js";import"./index-BLKRwB_-.js";import"./use-form-item-94WQABG4.js";import"./use-form-common-props-CFNhUBoH.js";function U(a){return m(this,null,function*(){return G.get("/energy/report",{params:a})})}function W(a="monthly",l){return[{align:"center",field:"time",fixed:"left",title:a==="monthly"?e("system.energyReport.date"):e("system.energyReport.month"),width:120},{align:"center",title:e("system.energyReport.load"),children:[{align:"center",field:"loadSharp",title:e("system.energyReport.timeSlots.sharp"),width:80},{align:"center",field:"loadPeak",title:e("system.energyReport.timeSlots.peak"),width:80},{align:"center",field:"loadFlat",title:e("system.energyReport.timeSlots.flat"),width:80},{align:"center",field:"loadValley",title:e("system.energyReport.timeSlots.valley"),width:80},{align:"center",field:"loadDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:80},{align:"center",field:"loadTotal",title:e("system.energyReport.timeSlots.total"),width:80}]},{align:"center",title:e("system.energyReport.wind"),children:[{align:"center",field:"windSharp",title:e("system.energyReport.timeSlots.sharp"),width:80},{align:"center",field:"windPeak",title:e("system.energyReport.timeSlots.peak"),width:80},{align:"center",field:"windFlat",title:e("system.energyReport.timeSlots.flat"),width:80},{align:"center",field:"windValley",title:e("system.energyReport.timeSlots.valley"),width:80},{align:"center",field:"windDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:80},{align:"center",field:"windTotal",title:e("system.energyReport.timeSlots.total"),width:80}]},{align:"center",title:e("system.energyReport.storage"),children:[{align:"center",title:e("system.energyReport.charge"),children:[{align:"center",field:"storageChargeSharp",title:e("system.energyReport.timeSlots.sharp"),width:70},{align:"center",field:"storageChargePeak",title:e("system.energyReport.timeSlots.peak"),width:70},{align:"center",field:"storageChargeFlat",title:e("system.energyReport.timeSlots.flat"),width:70},{align:"center",field:"storageChargeValley",title:e("system.energyReport.timeSlots.valley"),width:70},{align:"center",field:"storageChargeDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:70},{align:"center",field:"storageChargeTotal",title:e("system.energyReport.timeSlots.total"),width:70}]},{align:"center",title:e("system.energyReport.discharge"),children:[{align:"center",field:"storageDischargeSharp",title:e("system.energyReport.timeSlots.sharp"),width:70},{align:"center",field:"storageDischargePeak",title:e("system.energyReport.timeSlots.peak"),width:70},{align:"center",field:"storageDischargeFlat",title:e("system.energyReport.timeSlots.flat"),width:70},{align:"center",field:"storageDischargeValley",title:e("system.energyReport.timeSlots.valley"),width:70},{align:"center",field:"storageDischargeDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:70},{align:"center",field:"storageDischargeTotal",title:e("system.energyReport.timeSlots.total"),width:70}]}]},{align:"center",title:e("system.energyReport.chargingPile"),children:[{align:"center",field:"chargingPileSharp",title:e("system.energyReport.timeSlots.sharp"),width:80},{align:"center",field:"chargingPilePeak",title:e("system.energyReport.timeSlots.peak"),width:80},{align:"center",field:"chargingPileFlat",title:e("system.energyReport.timeSlots.flat"),width:80},{align:"center",field:"chargingPileValley",title:e("system.energyReport.timeSlots.valley"),width:80},{align:"center",field:"chargingPileDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:80},{align:"center",field:"chargingPileTotal",title:e("system.energyReport.timeSlots.total"),width:80}]},{align:"center",title:e("system.energyReport.grid"),children:[{align:"center",field:"gridSharp",title:e("system.energyReport.timeSlots.sharp"),width:80},{align:"center",field:"gridPeak",title:e("system.energyReport.timeSlots.peak"),width:80},{align:"center",field:"gridFlat",title:e("system.energyReport.timeSlots.flat"),width:80},{align:"center",field:"gridValley",title:e("system.energyReport.timeSlots.valley"),width:80},{align:"center",field:"gridDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:80},{align:"center",field:"gridTotal",title:e("system.energyReport.timeSlots.total"),width:80}]},{align:"center",title:e("system.energyReport.solar"),children:[{align:"center",title:e("system.energyReport.consumption"),children:[{align:"center",field:"solarConsumptionSharp",title:e("system.energyReport.timeSlots.sharp"),width:70},{align:"center",field:"solarConsumptionPeak",title:e("system.energyReport.timeSlots.peak"),width:70},{align:"center",field:"solarConsumptionFlat",title:e("system.energyReport.timeSlots.flat"),width:70},{align:"center",field:"solarConsumptionValley",title:e("system.energyReport.timeSlots.valley"),width:70},{align:"center",field:"solarConsumptionDeepValley",title:e("system.energyReport.timeSlots.deepValley"),width:70},{align:"center",field:"solarConsumptionTotal",title:e("system.energyReport.timeSlots.total"),width:70}]},{align:"center",field:"gridConnection",title:e("system.energyReport.gridConnection"),width:80},{align:"center",field:"grandTotal",title:e("system.energyReport.total"),width:80}]}]}const H=q({__name:"index",setup(a){const l=j("monthly");function i(o){return m(this,null,function*(){try{return{items:(yield U(o)).items}}catch(t){return console.error("获取企业能源报表数据失败:",t),{items:[]}}})}function f(o){const t={time:e("system.energyReport.footer.total")};if(o.length===0)return t;const r=o[0];return Object.keys(r).forEach(n=>{if(n!=="time"){const y=o.reduce((C,F)=>{const x=Number(F[n])||0;return C+x},0);t[n]=Number(y.toFixed(1))}}),t}function c(o){const t=o==="monthly";return{collapsed:!1,commonConfig:{componentProps:{class:"w-full"}},fieldMappingTime:[["time",["startTime","endTime"],t?"YYYY-MM-DD":"YYYY-MM"]],schema:[{component:"SearchSelector",fieldName:"enterprise",label:e("system.energyReport.form.enterpriseSelect"),componentProps:{class:"w-full sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-sm",placeholder:e("system.energyReport.form.enterprisePlaceholder"),searchPlaceholder:e("system.energyReport.form.enterpriseSearchPlaceholder"),buttonType:"default",buttonSize:"default",placement:"bottom-start",popoverWidth:300,filterable:!0,remote:!1,dataSource:r=>m(null,null,function*(){try{console.log("SearchSelector dataSource called with keyword:",r);const n=yield B(r||void 0);return console.log("Enterprise list loaded:",n.length,"items"),n}catch(n){console.error("获取企业列表失败:",n);const y=[];return r&&r.trim()?y.filter(C=>C.label.toLowerCase().includes(r.toLowerCase())):(console.log("Using fallback enterprise data:",y.length,"items"),y)}}),onChange:(r,n)=>{console.log("Enterprise selected:",r,n)}}},{component:"RangePicker",defaultValue:t?[S().subtract(7,"days"),S()]:[S().subtract(11,"months").startOf("month"),S().endOf("month")],fieldName:"time",label:t?e("system.energyReport.form.dateRange"):e("system.energyReport.form.monthRange"),componentProps:{class:"w-full",startPlaceholder:t?e("system.energyReport.form.startDate"):e("system.energyReport.form.startMonth"),endPlaceholder:t?e("system.energyReport.form.endDate"):e("system.energyReport.form.endMonth"),rangeSeparator:e("system.energyReport.form.separator"),format:t?"YYYY-MM-DD":"YYYY-MM",valueFormat:t?"YYYY-MM-DD":"YYYY-MM",clearable:!0,size:"default",type:t?"daterange":"monthrange"}}],showCollapseButton:!1,submitOnChange:!0,submitOnEnter:!1,layout:"horizontal"}}const R=o=>({columns:W(o),height:"auto",keepSource:!0,showFooter:!0,footerData:[{time:e("system.energyReport.footer.total"),loadSharp:0,loadPeak:0,loadFlat:0,loadValley:0,loadDeepValley:0,loadTotal:0,windSharp:0,windPeak:0,windFlat:0,windValley:0,windDeepValley:0,windTotal:0,storageChargeSharp:0,storageChargePeak:0,storageChargeFlat:0,storageChargeValley:0,storageChargeDeepValley:0,storageChargeTotal:0,storageDischargeSharp:0,storageDischargePeak:0,storageDischargeFlat:0,storageDischargeValley:0,storageDischargeDeepValley:0,storageDischargeTotal:0,chargingPileSharp:0,chargingPilePeak:0,chargingPileFlat:0,chargingPileValley:0,chargingPileDeepValley:0,chargingPileTotal:0,gridSharp:0,gridPeak:0,gridFlat:0,gridValley:0,gridDeepValley:0,gridTotal:0,solarConsumptionSharp:0,solarConsumptionPeak:0,solarConsumptionFlat:0,solarConsumptionValley:0,solarConsumptionDeepValley:0,solarConsumptionTotal:0,gridConnection:0,grandTotal:0}],pagerConfig:{enabled:!1},rowConfig:{keyField:"time"},toolbarConfig:{search:!1,custom:!0,export:!0,refresh:{code:"query"},zoom:!0}}),[u,p]=Y({formOptions:c("monthly"),showSearchForm:!0,gridOptions:b(D({},R("monthly")),{proxyConfig:{autoLoad:!1,ajax:{query:(o,t)=>m(null,null,function*(){var n;if(console.log("月报搜索参数:",t),!(t!=null&&t.enterprise))return console.log("未选择企业，跳过月报数据查询"),{items:[]};console.log("开始查询月报数据，企业:",t.enterprise);const r=yield i({startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,enterprise:t==null?void 0:t.enterprise,reportType:"monthly"});if(console.log("月报数据查询完成，数据条数:",((n=r.items)==null?void 0:n.length)||0),r.items&&r.items.length>0){const y=f(r.items);p.setGridOptions({footerData:[y]})}return r})}}})}),[g,d]=Y({formOptions:c("yearly"),showSearchForm:!0,gridOptions:b(D({},R("yearly")),{proxyConfig:{autoLoad:!1,ajax:{query:(o,t)=>m(null,null,function*(){var n;if(console.log("年报搜索参数:",t),!(t!=null&&t.enterprise))return console.log("未选择企业，跳过年报数据查询"),{items:[]};console.log("开始查询年报数据，企业:",t.enterprise);const r=yield i({startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,enterprise:t==null?void 0:t.enterprise,reportType:"yearly"});if(console.log("年报数据查询完成，数据条数:",((n=r.items)==null?void 0:n.length)||0),r.items&&r.items.length>0){const y=f(r.items);d.setGridOptions({footerData:[y]})}return r})}}})});return A(l,o=>{setTimeout(()=>{o==="monthly"?p.query():d.query()},100)}),(o,t)=>(z(),N(s(I),{"auto-content-height":""},{default:w(()=>[h(s(L),{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=r=>l.value=r),"tab-position":"left",class:"energy-report-tabs"},{default:w(()=>[h(s(k),{label:s(e)("system.energyReport.tabs.monthly"),name:"monthly"},{default:w(()=>[h(s(u),{"table-title":`${s(e)("system.energyReport.title")} - ${s(e)("system.energyReport.tabs.monthly")}`,"table-title-help":s(e)("system.energyReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"]),h(s(k),{label:s(e)("system.energyReport.tabs.yearly"),name:"yearly"},{default:w(()=>[h(s(g),{"table-title":`${s(e)("system.energyReport.title")} - ${s(e)("system.energyReport.tabs.yearly")}`,"table-title-help":s(e)("system.energyReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}))}}),ce=$(H,[["__scopeId","data-v-cc534c9d"]]);export{ce as default};
