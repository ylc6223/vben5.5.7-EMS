var C=Object.defineProperty,D=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var x=(l,r,n)=>r in l?C(l,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[r]=n,b=(l,r)=>{for(var n in r||(r={}))O.call(r,n)&&x(l,n,r[n]);if(E)for(var n of E(r))S.call(r,n)&&x(l,n,r[n]);return l},Y=(l,r)=>D(l,W(r));var w=(l,r,n)=>new Promise((u,y)=>{var f=c=>{try{p(n.next(c))}catch(d){y(d)}},P=c=>{try{p(n.throw(c))}catch(d){y(d)}},p=c=>c.done?u(c.value):Promise.resolve(c.value).then(f,P);p((n=n.apply(l,r)).next())});import{$ as t,_ as k}from"./bootstrap-DKNppDM-.js";import{e as F,r as A,w as G,v as z,j as $,I as g,y as h,u as s,a0 as I}from"../jse/index-index-CClcjv6z.js";import{E as j,a as _,s as q}from"./enterprise-CIYm-gLL.js";import{u as T}from"./vxe-table-BySml_v5.js";import{d as N}from"./report-DfgTrm3o.js";import{_ as L}from"./page.vue_vue_type_script_setup_true_lang-DC8d8YcG.js";import"./error-Cq9Fpw4b.js";import"./strings-CjSmUTd0.js";import"./event-BB_Ol6Sd.js";import"./vnode-DrRWajJj.js";import"./loading-CMDzNo7D.js";import"./css-B_CDxaI0.js";import"./index-DbQGFv3H.js";import"./debounce-Cbv_-rf3.js";import"./index-C7broldF.js";import"./scroll-MnIlRsTY.js";import"./index-CB6HUdZy.js";import"./index-BLKRwB_-.js";import"./use-form-item-94WQABG4.js";import"./use-form-common-props-CFNhUBoH.js";function B(l="monthly",r){return[{align:"center",field:"time",fixed:"left",title:l==="monthly"?t("system.windPowerIncomeReport.date"):t("system.windPowerIncomeReport.month"),width:120},{align:"center",title:t("system.windPowerIncomeReport.sharp"),children:[{align:"center",field:"sharpElectricity",title:t("system.windPowerIncomeReport.sharpElectricity"),minWidth:120},{align:"center",field:"sharpIncome",title:t("system.windPowerIncomeReport.sharpIncome"),minWidth:120}]},{align:"center",title:t("system.windPowerIncomeReport.peak"),children:[{align:"center",field:"peakElectricity",title:t("system.windPowerIncomeReport.peakElectricity"),minWidth:120},{align:"center",field:"peakIncome",title:t("system.windPowerIncomeReport.peakIncome"),minWidth:120}]},{align:"center",title:t("system.windPowerIncomeReport.flat"),children:[{align:"center",field:"flatElectricity",title:t("system.windPowerIncomeReport.flatElectricity"),minWidth:120},{align:"center",field:"flatIncome",title:t("system.windPowerIncomeReport.flatIncome"),minWidth:120}]},{align:"center",title:t("system.windPowerIncomeReport.valley"),children:[{align:"center",field:"valleyElectricity",title:t("system.windPowerIncomeReport.valleyElectricity"),minWidth:120},{align:"center",field:"valleyIncome",title:t("system.windPowerIncomeReport.valleyIncome"),minWidth:120}]},{align:"center",title:t("system.windPowerIncomeReport.deepValley"),children:[{align:"center",field:"deepValleyElectricity",title:t("system.windPowerIncomeReport.deepValleyElectricity"),minWidth:120},{align:"center",field:"deepValleyIncome",title:t("system.windPowerIncomeReport.deepValleyIncome"),minWidth:120}]},{align:"center",field:"totalAmount",title:t("system.windPowerIncomeReport.totalAmount"),minWidth:140},{align:"center",field:"totalIncome",title:t("system.windPowerIncomeReport.totalIncome"),minWidth:140}]}const U=F({__name:"index",setup(l){const r=A("monthly");function n(a){return w(this,null,function*(){try{return{items:(yield N(a)).items}}catch(e){return console.error("获取风电收益报表数据失败:",e),{items:[]}}})}function u(a){const e={time:t("system.windPowerIncomeReport.footer.total")};if(a.length===0)return e;const o=a[0];return Object.keys(o).forEach(i=>{if(i!=="time"){const m=a.reduce((R,M)=>{const v=Number(M[i])||0;return R+v},0);e[i]=Number(m.toFixed(2))}}),e}function y(a){const e=a==="monthly";return{collapsed:!1,commonConfig:{componentProps:{class:"w-full"}},fieldMappingTime:[["time",["startTime","endTime"],e?"YYYY-MM-DD":"YYYY-MM"]],schema:[{component:"SearchSelector",fieldName:"enterprise",label:t("system.windPowerIncomeReport.form.enterpriseSelect"),componentProps:{class:"w-full sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-sm",placeholder:t("system.windPowerIncomeReport.form.enterprisePlaceholder"),searchPlaceholder:t("system.windPowerIncomeReport.form.enterpriseSearchPlaceholder"),buttonType:"default",buttonSize:"default",placement:"bottom-start",popoverWidth:300,filterable:!0,remote:!1,dataSource:o=>w(null,null,function*(){try{console.log("SearchSelector dataSource called with keyword:",o);const i=yield q(o||void 0);return console.log("Enterprise list loaded:",i.length,"items"),i}catch(i){console.error("获取企业列表失败:",i);const m=[];return o&&o.trim()?m.filter(R=>R.label.toLowerCase().includes(o.toLowerCase())):(console.log("Using fallback enterprise data:",m.length,"items"),m)}}),onChange:(o,i)=>{console.log("Enterprise selected:",o,i)}}},{component:"RangePicker",defaultValue:e?[I().subtract(7,"days"),I()]:[I().subtract(11,"months").startOf("month"),I().endOf("month")],fieldName:"time",label:e?t("system.windPowerIncomeReport.form.dateRange"):t("system.windPowerIncomeReport.form.monthRange"),componentProps:{class:"w-full",startPlaceholder:e?t("system.windPowerIncomeReport.form.startDate"):t("system.windPowerIncomeReport.form.startMonth"),endPlaceholder:e?t("system.windPowerIncomeReport.form.endDate"):t("system.windPowerIncomeReport.form.endMonth"),rangeSeparator:t("system.windPowerIncomeReport.form.separator"),format:e?"YYYY-MM-DD":"YYYY-MM",valueFormat:e?"YYYY-MM-DD":"YYYY-MM",clearable:!0,size:"default",type:e?"daterange":"monthrange"}}],showCollapseButton:!1,submitOnChange:!0,submitOnEnter:!1,layout:"horizontal"}}const f=a=>({columns:B(a),height:"auto",keepSource:!0,showFooter:!0,resizable:!0,autoResize:!0,columnConfig:{resizable:!0,useKey:!0},border:!0,stripe:!0,round:!0,footerData:[{time:t("system.windPowerIncomeReport.footer.total"),sharpElectricity:0,sharpIncome:0,peakElectricity:0,peakIncome:0,flatElectricity:0,flatIncome:0,valleyElectricity:0,valleyIncome:0,deepValleyElectricity:0,deepValleyIncome:0,totalAmount:0,totalIncome:0}],pagerConfig:{enabled:!1},rowConfig:{keyField:"time"},toolbarConfig:{search:!1,custom:!0,export:!0,refresh:{code:"query"},zoom:!0}}),[P,p]=T({formOptions:y("monthly"),showSearchForm:!0,gridOptions:Y(b({},f("monthly")),{proxyConfig:{autoLoad:!1,ajax:{query:(a,e)=>w(null,null,function*(){var i;if(console.log("月报搜索参数:",e),!(e!=null&&e.enterprise))return console.log("未选择企业，跳过月报数据查询"),{items:[]};console.log("开始查询月报数据，企业:",e.enterprise);const o=yield n({startTime:e==null?void 0:e.startTime,endTime:e==null?void 0:e.endTime,enterprise:e==null?void 0:e.enterprise,reportType:"monthly"});if(console.log("月报数据查询完成，数据条数:",((i=o.items)==null?void 0:i.length)||0),o.items&&o.items.length>0){const m=u(o.items);p.setGridOptions({footerData:[m]})}return o})}}})}),[c,d]=T({formOptions:y("yearly"),showSearchForm:!0,gridOptions:Y(b({},f("yearly")),{proxyConfig:{autoLoad:!1,ajax:{query:(a,e)=>w(null,null,function*(){var i;if(console.log("年报搜索参数:",e),!(e!=null&&e.enterprise))return console.log("未选择企业，跳过年报数据查询"),{items:[]};console.log("开始查询年报数据，企业:",e.enterprise);const o=yield n({startTime:e==null?void 0:e.startTime,endTime:e==null?void 0:e.endTime,enterprise:e==null?void 0:e.enterprise,reportType:"yearly"});if(console.log("年报数据查询完成，数据条数:",((i=o.items)==null?void 0:i.length)||0),o.items&&o.items.length>0){const m=u(o.items);d.setGridOptions({footerData:[m]})}return o})}}})});return G(r,a=>{setTimeout(()=>{a==="monthly"?p.query():d.query()},100)}),(a,e)=>($(),z(s(L),{"auto-content-height":""},{default:g(()=>[h(s(j),{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value=o),"tab-position":"left",class:"wind-power-income-report-tabs"},{default:g(()=>[h(s(_),{label:s(t)("system.windPowerIncomeReport.tabs.monthly"),name:"monthly"},{default:g(()=>[h(s(P),{"table-title":`${s(t)("system.windPowerIncomeReport.title")} - ${s(t)("system.windPowerIncomeReport.tabs.monthly")}`,"table-title-help":s(t)("system.windPowerIncomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"]),h(s(_),{label:s(t)("system.windPowerIncomeReport.tabs.yearly"),name:"yearly"},{default:g(()=>[h(s(c),{"table-title":`${s(t)("system.windPowerIncomeReport.title")} - ${s(t)("system.windPowerIncomeReport.tabs.yearly")}`,"table-title-help":s(t)("system.windPowerIncomeReport.description")},null,8,["table-title","table-title-help"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}))}}),we=k(U,[["__scopeId","data-v-0d0645e1"]]);export{we as default};
